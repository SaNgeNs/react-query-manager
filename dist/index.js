"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _createStarExport(obj) { Object.keys(obj) .filter((key) => key !== "default" && key !== "__esModule") .forEach((key) => { if (exports.hasOwnProperty(key)) { return; } Object.defineProperty(exports, key, {enumerable: true, configurable: true, get: () => obj[key]}); }); } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _reactquery = require('@tanstack/react-query'); _createStarExport(_reactquery);var _eventemitter3 = require('eventemitter3'); var _eventemitter32 = _interopRequireDefault(_eventemitter3);function L(e,t){let s={...e};if(e instanceof Object&&t instanceof Object){for(let u in t)if(u in e){let o=e[u],y=t[u];typeof o==typeof y&&(Array.isArray(o)&&Array.isArray(y)||o!==null&&!Array.isArray(o)&&typeof o=="object"&&!Array.isArray(y)&&typeof y=="object"||typeof o!="object"&&typeof y!="object")&&(typeof o=="object"&&o!==null&&!Array.isArray(o)?s[u]=L(o,y):s[u]=y)}}return s}var S=async(e,t)=>{let s=t.reduce((u,o)=>u.concat(e.getQueriesData({queryKey:o})),[]);return await Promise.all(s.map(([u])=>e.cancelQueries({queryKey:u}))),s};function U(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var v=new _eventemitter32.default,b={once:(e,t)=>{v.once(e,t)},emit:(e,t)=>{v.emit(e,t)}};var C=e=>{let t=e.path.replace(/{(\w+)}/g,(s,u)=>e.params[u].toString());return U(t)};var _reactquerydevtools = require('@tanstack/react-query-devtools');var _react = require('react'); var _react2 = _interopRequireDefault(_react);var M=class e extends Error{constructor(s,u,o){super(s);this.message=s;this.status=u;this.data=o;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(s).stack,this.stack=new Error().stack,console.error(this.message,this)}};function A(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:s}=e,u=e.data instanceof FormData,o=(()=>{let r=e.url;if(e.params){if(e.queryParamsSerializer)r+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(e.params).length>0){let i=[];for(let m in e.params)e.params.hasOwnProperty(m)&&(Array.isArray(e.params[m])?e.params[m].forEach(g=>{i.push(`${A(m)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${A(g)}`)}):i.push(`${A(m)}=${A(e.params[m])}`));r+=`?${i.join("&")}`}}let[a,n]=r.split("?");return a.charAt(a.length-1)!=="/"&&!n?`${a}/${`${n?`?${n}`:""}`}`:`${a}${n?`?${n}`:""}`})(),y=u?e.data:e.data?JSON.stringify(e.data):"",c={method:e.method,headers:{...!u&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...y&&{body:y},...e.options};return fetch(o,c).then(async r=>{let a=await(async()=>{try{let i=_optionalChain([r, 'access', _2 => _2.headers, 'access', _3 => _3.get, 'call', _4 => _4("Content-Type"), 'optionalAccess', _5 => _5.toLowerCase, 'call', _6 => _6()])||"";return i.includes("application/json")?await r.json():i.includes("text/plain")||i.includes("text/csv")||i.includes("application/xml")||i.includes("text/xml")||i.includes("application/javascript")||i.includes("text/html")?await r.text():i.includes("multipart/form-data")?await r.formData():await r.blob()}catch(i){throw console.error("Error handling response:",i),i}})(),n={};return r.headers.forEach((i,m)=>{n[m]=i}),{status:r.status,statusText:r.statusText,headers:n,data:a}}).then(r=>{if(r.status<200||r.status>=300){let a=new M(`Request failed with status code: ${r.status}`,r.status,r.data);return s&&s(a,e),Promise.reject(a)}return t&&t(r,e),Promise.resolve(r)}).catch(r=>Promise.reject(new M(r.message)))};var _headless = require('react-hot-toast/headless'); var _headless2 = _interopRequireDefault(_headless);var Z=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function ee({id:e,className:t,style:s,onHeightUpdate:u,children:o}){let y=_react.useCallback.call(void 0, c=>{if(c){let r=()=>{let{height:a}=c.getBoundingClientRect();u(e,a)};r(),new MutationObserver(r).observe(c,{subtree:!0,childList:!0,characterData:!0})}},[e,u]);return _react2.default.createElement("div",{ref:y,className:t,style:s},o)}var te=(e,t)=>{let s=e.includes("top"),u=s?{top:0}:{bottom:0},o=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Z()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(s?1:-1)}px)`,...u,...o}},O=16;function $({reverseOrder:e,position:t="top-center",toastOptions:s,gutter:u,children:o,containerStyle:y,containerClassName:c}){let{toasts:r,handlers:a}=_headless.useToaster.call(void 0, s);return _react2.default.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...y},className:c,onMouseEnter:a.startPause,onMouseLeave:a.endPause},r.map(n=>{let i=n.position||t,m={...n,position:i},g=a.calculateOffset(m,{reverseOrder:e,gutter:u,defaultPosition:t}),Q=te(i,g);return _react2.default.createElement(ee,{id:m.id,key:m.id,onHeightUpdate:a.updateHeight,style:{...Q,pointerEvents:"auto"}},m.type==="custom"?_headless.resolveValue.call(void 0, n.message,m):o?o(m):_react2.default.createElement("div",{style:{display:n.visible?"flex":"none"}},_headless.resolveValue.call(void 0, m.message,m)))}))}var _reacthottoast = require('react-hot-toast');var{remove:qe,...se}=_headless2.default,I= exports.toast =Object.assign((...e)=>_headless2.default.call(void 0, ...e),se),Ie= exports.ToastBar =_reacthottoast.ToastBar,Be= exports.resolveToastValue =_reacthottoast.resolveValue;var W=_react.createContext.call(void 0, {apiUrl:"",apiClient:B,toastUndo:()=>{}}),F= exports.useRQWrapperContext =()=>_react.useContext.call(void 0, W);function He({children:e,config:t={},apiUrl:s,apiClient:u=B,apiAuthorization:o,apiHeaders:y,apiOnSuccess:c,apiOnError:r,isDevTools:a,devToolsOptions:n,toast:i}){let m=_react.useMemo.call(void 0, ()=>new (0, _reactquery.QueryClient)({...t,defaultOptions:{..._optionalChain([t, 'optionalAccess', _7 => _7.defaultOptions]),queries:{gcTime:3e5,staleTime:3e5,retry:!1,..._optionalChain([t, 'optionalAccess', _8 => _8.defaultOptions, 'optionalAccess', _9 => _9.queries])}}}),[]),g=_react.useCallback.call(void 0, p=>{let T=o?o():"",d=y?y():{},P=(...D)=>{c&&c(...D),p.onSuccess&&p.onSuccess(...D)},h=(...D)=>{r&&r(...D),p.onError&&p.onError(...D)};return u({...p,headers:p.headers?{...d,...p.headers}:d,authorization:p.authorization||T,onSuccess:P,onError:h})},[]),Q=_react.useCallback.call(void 0, p=>{let T=!1;I.dismiss();let d=()=>{T=!0,b.emit("end",!0),I.dismiss()},P=_optionalChain([i, 'optionalAccess', _10 => _10.customUndoContent])?_optionalChain([i, 'optionalAccess', _11 => _11.customUndoContent, 'call', _12 => _12({message:p.message,onUndo:d,type:p.type})]):null;I.success(h=>(!h.visible&&!T&&(T=!0,b.emit("end",!1)),P||_react2.default.createElement(_react2.default.Fragment,null,p.message,_react2.default.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:d,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:_optionalChain([i, 'optionalAccess', _13 => _13.globalProps, 'optionalAccess', _14 => _14.toastOptions, 'optionalAccess', _15 => _15.duration])||5e3})},[]),l=_react.useMemo.call(void 0, ()=>({apiUrl:U(s),apiClient:g,toastUndo:Q}),[s,g,Q]);return _react2.default.createElement(_reactquery.QueryClientProvider,{client:m},_react2.default.createElement($,{..._optionalChain([i, 'optionalAccess', _16 => _16.globalProps])},_optionalChain([i, 'optionalAccess', _17 => _17.wrapper])),_react2.default.createElement(W.Provider,{value:l},e),a&&_react2.default.createElement(_reactquerydevtools.ReactQueryDevtools,{buttonPosition:"bottom-right",initialIsOpen:!1,...n}))}var Ze=({queryOptions:e,resource:t,params:s={},apiClientParams:u})=>{let{apiUrl:o,apiClient:y}=F();return _reactquery.useQuery.call(void 0, {...e,queryKey:["get-list",t.path,t.params,s,..._optionalChain([e, 'optionalAccess', _18 => _18.queryKey])?e.queryKey:[]],queryFn:async({queryKey:r})=>{let a={resource:t,params:s,queryKey:r},n=`${o}/${C(a.resource)}/`;return _optionalChain([e, 'optionalAccess', _19 => _19.queryFn])?await _optionalChain([e, 'optionalAccess', _20 => _20.queryFn, 'call', _21 => _21({apiClient:y,variables:a,url:n})]):await y({url:n,method:"GET",params:s,...u})}})};var ot=({queryOptions:e,resource:t,params:s={},apiClientParams:u,pagination:o})=>{let{apiUrl:y,apiClient:c}=F();return _reactquery.useInfiniteQuery.call(void 0, {initialPageParam:1,getNextPageParam:(...a)=>{let n=a[0],i=Number(a[2]);if(_optionalChain([n, 'optionalAccess', _22 => _22.data, 'optionalAccess', _23 => _23.length]))return i+1},getPreviousPageParam:(...a)=>{let n=Number(a[2]);if(!(n<=1))return n-1},...e,queryKey:["get-infinite-list",t.path,t.params,o,s,..._optionalChain([e, 'optionalAccess', _24 => _24.queryKey])?e.queryKey:[]],queryFn:async({queryKey:a,pageParam:n})=>{let i={resource:t,params:{...s,[o.page[0]]:n,[o.per_page[0]]:o.per_page[1]},queryKey:a},m=`${y}/${C(i.resource)}/`;return _optionalChain([e, 'optionalAccess', _25 => _25.queryFn])?await _optionalChain([e, 'optionalAccess', _26 => _26.queryFn, 'call', _27 => _27({apiClient:c,variables:i,url:m})]):await c({url:m,method:"GET",params:i.params,...u})}})};var pt=({resource:e,id:t,queryOptions:s,params:u={},apiClientParams:o})=>{let{apiUrl:y,apiClient:c}=F();return _reactquery.useQuery.call(void 0, {...s,queryKey:["get-one",e.path,e.params,String(t),u,..._optionalChain([s, 'optionalAccess', _28 => _28.queryKey])?s.queryKey:[]],queryFn:async({queryKey:a})=>{let n={id:t,resource:e,params:u,queryKey:a},i=`${y}/${C(n.resource)}/`;return _optionalChain([s, 'optionalAccess', _29 => _29.queryFn])?await _optionalChain([s, 'optionalAccess', _30 => _30.queryFn, 'call', _31 => _31({apiClient:c,variables:n,url:i})]):await c({url:`${i}${n.id}/`,method:"GET",params:u,...o})}})};var z=({queryClient:e,ids:t,queryKeysOne:s,queryKeysList:u,queryKeysInfiniteList:o})=>{let y=c=>!c||!(c.data instanceof Array)?c:{...c,data:c.data.filter(r=>!t.some(a=>String(a)===String(r.id)))};s&&s.forEach(c=>{e.removeQueries({queryKey:c})}),u&&u.forEach(c=>{e.setQueriesData({queryKey:c},y)}),o&&o.forEach(c=>{e.setQueriesData({queryKey:c},r=>r&&{...r,pages:r.pages.map(y)})})},N= exports.updateItemsFromQueryCache =({queryClient:e,data:t,ids:s,queryKeysOne:u,queryKeysList:o,queryKeysInfiniteList:y})=>{let c=r=>!r||!(r.data instanceof Array)?r:{...r,data:r.data.map(a=>s.some(n=>String(n)===String(a.id))?L(a,t):a)};u&&u.forEach(r=>{e.setQueriesData({queryKey:r},a=>!a||!(a.data instanceof Object)||!(t instanceof Object)?a:{...a,data:L(a.data,t)})}),o&&o.forEach(r=>{e.setQueriesData({queryKey:r},c)}),y&&y.forEach(r=>{e.setQueriesData({queryKey:r},a=>a&&{...a,pages:a.pages.map(c)})})},f= exports.helpersQueryKeys ={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(s=>["get-one",e.path,e.params,String(s)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params]};var E=({queryClient:e,queryKeys:t})=>{t.forEach(s=>{e.invalidateQueries({queryKey:s})})},G=({queryClient:e,queryKeys:t,data:s})=>{t.forEach(u=>{e.setQueryData(u,s)})};var H=({resourcePath:e,mutationOptions:t,mode:s={optimistic:!0,undoable:!0},extraResources:u=[],type:o="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:r}=F(),a=_reactquery.useQueryClient.call(void 0, ),n=_react.useRef.call(void 0, []),i=()=>{n.current.forEach(([l,p])=>{a.setQueryData(l,p)})},{mutate:m,...g}=_reactquery.useMutation.call(void 0, {...t,mutationKey:[o==="many"?"delete-many":"delete-one",e,..._optionalChain([t, 'optionalAccess', _32 => _32.mutationKey])?t.mutationKey:[]],mutationFn:async l=>{let p=`${y}/${C(l.resource)}/`;if(_optionalChain([t, 'optionalAccess', _33 => _33.mutationFn]))return await _optionalChain([t, 'optionalAccess', _34 => _34.mutationFn, 'call', _35 => _35({apiClient:c,variables:l,url:p})]);let T=o==="many"?l.ids:[l.id],d=await Promise.allSettled(T.map(h=>c({url:`${p}${h}/`,method:"DELETE",...l.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),o==="many"?P:P[0]},onSuccess:(...l)=>{let p=l[1],T=[f.getList(p.resource),f.getInfiniteList(p.resource)];u.forEach(d=>{T.push(f.getList(d)),T.push(f.getInfiniteList(d))}),E({queryClient:a,queryKeys:T}),_optionalChain([t, 'optionalAccess', _36 => _36.onSuccess])&&t.onSuccess(...l)},onError:(...l)=>{_optionalChain([t, 'optionalAccess', _37 => _37.onError])&&t.onError(...l),i()}});return{mutation:g,delete:async({resourceParams:l,undoMessage:p,...T})=>{let d={path:e,params:l},P=o==="many"?T.ids:[T.id];if(s.optimistic){let h=f.getOneArray(d,P),D=[f.getList(d)],R=[f.getInfiniteList(d)];u.forEach(x=>{h.push(...f.getOneArray(x,P)),D.push(f.getList(x)),R.push(f.getInfiniteList(x))}),n.current=await S(a,[...h,...D,...R]),z({queryClient:a,ids:P,queryKeysOne:h,queryKeysList:D,queryKeysInfiniteList:R})}if(s.undoable){let h=P.length>1;b.once("end",D=>{D?i():m({...T,resource:d})}),r({message:p||`Element${h?"s":""} deleted`,type:h?"delete-many":"delete-one"})}else m({...T,resource:d})}}},Ft= exports.useDeleteOne =e=>H({...e,type:"one"}),Qt= exports.useDeleteMany =e=>H({...e,type:"many"});var _=({resourcePath:e,mutationOptions:t,mode:s={optimistic:!0,undoable:!0},extraResources:u=[],type:o="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:r}=F(),a=_reactquery.useQueryClient.call(void 0, ),n=_react.useRef.call(void 0, []),i=()=>{n.current.forEach(([l,p])=>{a.setQueryData(l,p)})},{mutate:m,...g}=_reactquery.useMutation.call(void 0, {...t,mutationKey:[o==="many"?"update-many":"update-one",e,..._optionalChain([t, 'optionalAccess', _38 => _38.mutationKey])?t.mutationKey:[]],mutationFn:async l=>{let p=`${y}/${C(l.resource)}/`;if(_optionalChain([t, 'optionalAccess', _39 => _39.mutationFn]))return await _optionalChain([t, 'optionalAccess', _40 => _40.mutationFn, 'call', _41 => _41({apiClient:c,variables:l,url:p})]);let T=o==="many"?l.ids:[l.id],d=await Promise.allSettled(T.map(h=>c({url:`${p}${h}/`,method:"PATCH",data:l.data,...l.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),o==="many"?P:P[0]},onSuccess:(...l)=>{let p=l[1];if(!s.optimistic){let T=o==="many"?p.ids:[p.id],d=[...f.getOneArray(p.resource,T),f.getList(p.resource),f.getInfiniteList(p.resource)];u.forEach(P=>{d.push(...f.getOneArray(P,T)),d.push(f.getList(P)),d.push(f.getInfiniteList(P))}),E({queryClient:a,queryKeys:d})}_optionalChain([t, 'optionalAccess', _42 => _42.onSuccess])&&t.onSuccess(...l)},onError:(...l)=>{_optionalChain([t, 'optionalAccess', _43 => _43.onError])&&t.onError(...l),i()}});return{mutation:g,update:async({resourceParams:l,undoMessage:p,...T})=>{let d={path:e,params:l},P=o==="many"?T.ids:[T.id];if(s.optimistic){let h=f.getOneArray(d,P),D=[f.getList(d)],R=[f.getInfiniteList(d)];u.forEach(x=>{h.push(...f.getOneArray(x,P)),D.push(f.getList(x)),R.push(f.getInfiniteList(x))}),n.current=await S(a,[...h,...D,...R]),N({queryClient:a,data:T.data,ids:P,queryKeysOne:h,queryKeysList:D,queryKeysInfiniteList:R})}if(s.undoable){let h=P.length>1;b.once("end",D=>{D?i():m({...T,resource:d})}),r({message:p||`Element${h?"s":""} updated`,type:h?"update-many":"update-one"})}else m({...T,resource:d})}}},Ut= exports.useUpdateOne =e=>_({...e,type:"one"}),At= exports.useUpdateMany =e=>_({...e,type:"many"});var $t=({resourcePath:e,mutationOptions:t,extraResources:s=[]})=>{let{apiUrl:u,apiClient:o}=F(),y=_reactquery.useQueryClient.call(void 0, ),{mutate:c,...r}=_reactquery.useMutation.call(void 0, {...t,mutationKey:["create",e,..._optionalChain([t, 'optionalAccess', _44 => _44.mutationKey])?t.mutationKey:[]],mutationFn:async n=>{let i=`${u}/${C(n.resource)}/`;return _optionalChain([t, 'optionalAccess', _45 => _45.mutationFn])?await _optionalChain([t, 'optionalAccess', _46 => _46.mutationFn, 'call', _47 => _47({apiClient:o,variables:n,url:i})]):await o({url:i,method:"POST",data:n.data,...n.apiClientParams})},onSuccess:(...n)=>{let i=n[0],m=n[1],{id:g}=i.data,Q=[f.getOne(m.resource,g)],l=[f.getList(m.resource)],p=[f.getInfiniteList(m.resource)];s.forEach(T=>{Q.push(f.getOne(T,g)),l.push(f.getList(T)),p.push(f.getInfiniteList(T))}),G({queryClient:y,queryKeys:Q.map(T=>[...T,{}]),data:n[0]}),E({queryClient:y,queryKeys:[...l,...p]}),_optionalChain([t, 'optionalAccess', _48 => _48.onSuccess])&&t.onSuccess(...n)}});return{mutation:r,create:({resourceParams:n,...i})=>{c({...i,resource:{path:e,params:n}})}}};exports.CustomError = M; exports.RQWrapper = He; exports.ToastBar = Ie; exports.deleteItemsFromQueryCache = z; exports.fetcher = B; exports.getUrlFromResource = C; exports.helpersQueryKeys = f; exports.resolveToastValue = Be; exports.toast = I; exports.updateItemsFromQueryCache = N; exports.useCreate = $t; exports.useDeleteMany = Qt; exports.useDeleteOne = Ft; exports.useGetInfiniteList = ot; exports.useGetList = Ze; exports.useGetOne = pt; exports.useRQWrapperContext = F; exports.useUpdateMany = At; exports.useUpdateOne = Ut;
//# sourceMappingURL=index.js.map