"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _createStarExport(obj) { Object.keys(obj) .filter((key) => key !== "default" && key !== "__esModule") .forEach((key) => { if (exports.hasOwnProperty(key)) { return; } Object.defineProperty(exports, key, {enumerable: true, configurable: true, get: () => obj[key]}); }); } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _reactquery = require('@tanstack/react-query'); _createStarExport(_reactquery);var _eventemitter3 = require('eventemitter3'); var _eventemitter32 = _interopRequireDefault(_eventemitter3);function L(e,t){let o={...e};if(e instanceof Object&&t instanceof Object){for(let n in t)if(n in e){let r=e[n],y=t[n];typeof r==typeof y&&(Array.isArray(r)&&Array.isArray(y)||r!==null&&!Array.isArray(r)&&typeof r=="object"&&!Array.isArray(y)&&typeof y=="object"||typeof r!="object"&&typeof y!="object")&&(typeof r=="object"&&r!==null&&!Array.isArray(r)?o[n]=L(r,y):o[n]=y)}}return o}var S=async(e,t)=>{let o=t.reduce((n,r)=>n.concat(e.getQueriesData({queryKey:r})),[]);return await Promise.all(o.map(([n])=>e.cancelQueries({queryKey:n}))),o};function A(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var w=new _eventemitter32.default,x={once:(e,t)=>{w.once(e,t)},emit:(e,t)=>{w.emit(e,t)}};var F=e=>{let t=e.path.replace(/{(\w+)}/g,(o,n)=>e.params[n].toString());return A(t)};var _reactquerydevtools = require('@tanstack/react-query-devtools');var _react = require('react'); var _react2 = _interopRequireDefault(_react);var M=class e extends Error{constructor(o,n,r){super(o);this.message=o;this.status=n;this.data=r;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(o).stack,this.stack=new Error().stack,console.error(this.message,this)}};var Y=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([n,r])=>{Array.isArray(r)?r.length>0&&(t[n]=r):r instanceof Object?r&&Object.keys(r).length>0&&(t[n]=r):(r||typeof r=="boolean")&&(t[n]=r)}),t}return{}};function U(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:o}=e,n=e.data instanceof FormData,r=(()=>{let a=e.url;if(e.params){let i=Y(e.params);if(e.queryParamsSerializer)a+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(i).length>0){let l=[];for(let D in i)i.hasOwnProperty(D)&&(Array.isArray(i[D])?i[D].forEach(C=>{l.push(`${U(D)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${U(C)}`)}):l.push(`${U(D)}=${U(i[D])}`));a+=`?${l.join("&")}`}}let[s,u]=a.split("?");return s.charAt(s.length-1)!=="/"&&!u?`${s}/${`${u?`?${u}`:""}`}`:`${s}${u?`?${u}`:""}`})(),y=n?e.data:e.data?JSON.stringify(e.data):"",c={method:e.method,headers:{...!n&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...y&&{body:y},...e.options};return fetch(r,c).then(async a=>{let s=await(async()=>{try{let i=_optionalChain([a, 'access', _2 => _2.headers, 'access', _3 => _3.get, 'call', _4 => _4("Content-Type"), 'optionalAccess', _5 => _5.toLowerCase, 'call', _6 => _6()])||"";return i.includes("application/json")?await a.json():i.includes("text/plain")||i.includes("text/csv")||i.includes("application/xml")||i.includes("text/xml")||i.includes("application/javascript")||i.includes("text/html")?await a.text():i.includes("multipart/form-data")?await a.formData():await a.blob()}catch(i){throw console.error("Error handling response:",i),i}})(),u={};return a.headers.forEach((i,l)=>{u[l]=i}),{status:a.status,statusText:a.statusText,headers:u,data:s}}).then(a=>{if(a.status<200||a.status>=300){let s=new M(`Request failed with status code: ${a.status}`,a.status,a.data);return o&&o(s,e),Promise.reject(s)}return t&&t(a,e),Promise.resolve(a)}).catch(a=>Promise.reject(new M(a.message)))};var _headless = require('react-hot-toast/headless'); var _headless2 = _interopRequireDefault(_headless);var ee=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function te({id:e,className:t,style:o,onHeightUpdate:n,children:r}){let y=_react.useCallback.call(void 0, c=>{if(c){let a=()=>{let{height:s}=c.getBoundingClientRect();n(e,s)};a(),new MutationObserver(a).observe(c,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return _react2.default.createElement("div",{ref:y,className:t,style:o},r)}var re=(e,t)=>{let o=e.includes("top"),n=o?{top:0}:{bottom:0},r=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ee()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(o?1:-1)}px)`,...n,...r}},O=16;function j({reverseOrder:e,position:t="top-center",toastOptions:o,gutter:n,children:r,containerStyle:y,containerClassName:c}){let{toasts:a,handlers:s}=_headless.useToaster.call(void 0, o);return _react2.default.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...y},className:c,onMouseEnter:s.startPause,onMouseLeave:s.endPause},a.map(u=>{let i=u.position||t,l={...u,position:i},D=s.calculateOffset(l,{reverseOrder:e,gutter:n,defaultPosition:t}),C=re(i,D);return _react2.default.createElement(te,{id:l.id,key:l.id,onHeightUpdate:s.updateHeight,style:{...C,pointerEvents:"auto"}},l.type==="custom"?_headless.resolveValue.call(void 0, u.message,l):r?r(l):_react2.default.createElement("div",{style:{display:u.visible?"flex":"none"}},_headless.resolveValue.call(void 0, l.message,l)))}))}var _reacthottoast = require('react-hot-toast');var{remove:Ie,...oe}=_headless2.default,I= exports.toast =Object.assign((...e)=>_headless2.default.call(void 0, ...e),oe),Be= exports.ToastBar =_reacthottoast.ToastBar,we= exports.resolveToastValue =_reacthottoast.resolveValue;var W=_react.createContext.call(void 0, {apiUrl:"",apiClient:B,toastUndo:()=>{}}),Q= exports.useRQWrapperContext =()=>_react.useContext.call(void 0, W);function _e({children:e,config:t={},apiUrl:o,apiClient:n=B,apiAuthorization:r,apiHeaders:y,apiOnSuccess:c,apiOnError:a,isDevTools:s,devToolsOptions:u,toast:i}){let l=_react.useMemo.call(void 0, ()=>new (0, _reactquery.QueryClient)({...t,defaultOptions:{..._optionalChain([t, 'optionalAccess', _7 => _7.defaultOptions]),queries:{gcTime:3e5,staleTime:3e5,retry:!1,..._optionalChain([t, 'optionalAccess', _8 => _8.defaultOptions, 'optionalAccess', _9 => _9.queries])}}}),[]),D=_react.useCallback.call(void 0, p=>{let f=r?r():"",d=y?y():{},P=(...g)=>{c&&c(...g),p.onSuccess&&p.onSuccess(...g)},h=(...g)=>{a&&a(...g),p.onError&&p.onError(...g)};return n({...p,headers:p.headers?{...d,...p.headers}:d,authorization:p.authorization||f,onSuccess:P,onError:h})},[]),C=_react.useCallback.call(void 0, p=>{let f=!1;I.dismiss();let d=()=>{f=!0,x.emit("end",!0),I.dismiss()},P=_optionalChain([i, 'optionalAccess', _10 => _10.customUndoContent])?_optionalChain([i, 'optionalAccess', _11 => _11.customUndoContent, 'call', _12 => _12({message:p.message,onUndo:d,type:p.type})]):null;I.success(h=>(!h.visible&&!f&&(f=!0,x.emit("end",!1)),P||_react2.default.createElement(_react2.default.Fragment,null,p.message,_react2.default.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:d,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:_optionalChain([i, 'optionalAccess', _13 => _13.globalProps, 'optionalAccess', _14 => _14.toastOptions, 'optionalAccess', _15 => _15.duration])||5e3})},[]),m=_react.useMemo.call(void 0, ()=>({apiUrl:A(o),apiClient:D,toastUndo:C}),[o,D,C]);return _react2.default.createElement(_reactquery.QueryClientProvider,{client:l},_react2.default.createElement(j,{..._optionalChain([i, 'optionalAccess', _16 => _16.globalProps])},_optionalChain([i, 'optionalAccess', _17 => _17.wrapper])),_react2.default.createElement(W.Provider,{value:m},e),s&&_react2.default.createElement(_reactquerydevtools.ReactQueryDevtools,{buttonPosition:"bottom-right",initialIsOpen:!1,...u}))}var et=({queryOptions:e,resource:t,params:o={},apiClientParams:n})=>{let{apiUrl:r,apiClient:y}=Q();return _reactquery.useQuery.call(void 0, {...e,queryKey:["get-list",t.path,t.params,o,..._optionalChain([e, 'optionalAccess', _18 => _18.queryKey])?e.queryKey:[]],queryFn:async({queryKey:a})=>{let s={resource:t,params:o,queryKey:a},u=`${r}/${F(s.resource)}/`;return _optionalChain([e, 'optionalAccess', _19 => _19.queryFn])?await _optionalChain([e, 'optionalAccess', _20 => _20.queryFn, 'call', _21 => _21({apiClient:y,variables:s,url:u})]):await y({url:u,method:"GET",params:o,...n})}})};var nt=({queryOptions:e,resource:t,params:o={},apiClientParams:n,pagination:r})=>{let{apiUrl:y,apiClient:c}=Q();return _reactquery.useInfiniteQuery.call(void 0, {initialPageParam:1,getNextPageParam:(...s)=>{let u=s[0],i=Number(s[2]);if(_optionalChain([u, 'optionalAccess', _22 => _22.data, 'optionalAccess', _23 => _23.length]))return i+1},getPreviousPageParam:(...s)=>{let u=Number(s[2]);if(!(u<=1))return u-1},...e,queryKey:["get-infinite-list",t.path,t.params,r,o,..._optionalChain([e, 'optionalAccess', _24 => _24.queryKey])?e.queryKey:[]],queryFn:async({queryKey:s,pageParam:u})=>{let i={resource:t,params:{...o,[r.page[0]]:u,[r.per_page[0]]:r.per_page[1]},queryKey:s},l=`${y}/${F(i.resource)}/`;return _optionalChain([e, 'optionalAccess', _25 => _25.queryFn])?await _optionalChain([e, 'optionalAccess', _26 => _26.queryFn, 'call', _27 => _27({apiClient:c,variables:i,url:l})]):await c({url:l,method:"GET",params:i.params,...n})}})};var yt=({resource:e,id:t,queryOptions:o,params:n={},apiClientParams:r})=>{let{apiUrl:y,apiClient:c}=Q();return _reactquery.useQuery.call(void 0, {...o,queryKey:["get-one",e.path,e.params,String(t),n,..._optionalChain([o, 'optionalAccess', _28 => _28.queryKey])?o.queryKey:[]],queryFn:async({queryKey:s})=>{let u={id:t,resource:e,params:n,queryKey:s},i=`${y}/${F(u.resource)}/`;return _optionalChain([o, 'optionalAccess', _29 => _29.queryFn])?await _optionalChain([o, 'optionalAccess', _30 => _30.queryFn, 'call', _31 => _31({apiClient:c,variables:u,url:i})]):await c({url:`${i}${u.id}/`,method:"GET",params:n,...r})}})};var z=({queryClient:e,ids:t,queryKeysOne:o,queryKeysList:n,queryKeysInfiniteList:r})=>{let y=c=>!c||!(c.data instanceof Array)?c:{...c,data:c.data.filter(a=>!t.some(s=>String(s)===String(a.id)))};o&&o.forEach(c=>{e.removeQueries({queryKey:c})}),n&&n.forEach(c=>{e.setQueriesData({queryKey:c},y)}),r&&r.forEach(c=>{e.setQueriesData({queryKey:c},a=>a&&{...a,pages:a.pages.map(y)})})},N= exports.updateItemsFromQueryCache =({queryClient:e,data:t,ids:o,queryKeysOne:n,queryKeysList:r,queryKeysInfiniteList:y})=>{let c=a=>!a||!(a.data instanceof Array)?a:{...a,data:a.data.map(s=>o.some(u=>String(u)===String(s.id))?L(s,t):s)};n&&n.forEach(a=>{e.setQueriesData({queryKey:a},s=>!s||!(s.data instanceof Object)||!(t instanceof Object)?s:{...s,data:L(s.data,t)})}),r&&r.forEach(a=>{e.setQueriesData({queryKey:a},c)}),y&&y.forEach(a=>{e.setQueriesData({queryKey:a},s=>s&&{...s,pages:s.pages.map(c)})})},T= exports.helpersQueryKeys ={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(o=>["get-one",e.path,e.params,String(o)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params]};var E=({queryClient:e,queryKeys:t})=>{t.forEach(o=>{e.invalidateQueries({queryKey:o})})},G=({queryClient:e,queryKeys:t,data:o})=>{t.forEach(n=>{e.setQueryData(n,o)})};var H=({resourcePath:e,mutationOptions:t,mode:o={optimistic:!0,undoable:!0},extraResources:n=[],type:r="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:a}=Q(),s=_reactquery.useQueryClient.call(void 0, ),u=_react.useRef.call(void 0, []),i=()=>{u.current.forEach(([m,p])=>{s.setQueryData(m,p)})},{mutate:l,...D}=_reactquery.useMutation.call(void 0, {...t,mutationKey:[r==="many"?"delete-many":"delete-one",e,..._optionalChain([t, 'optionalAccess', _32 => _32.mutationKey])?t.mutationKey:[]],mutationFn:async m=>{let p=`${y}/${F(m.resource)}/`;if(_optionalChain([t, 'optionalAccess', _33 => _33.mutationFn]))return await _optionalChain([t, 'optionalAccess', _34 => _34.mutationFn, 'call', _35 => _35({apiClient:c,variables:m,url:p})]);let f=r==="many"?m.ids:[m.id],d=await Promise.allSettled(f.map(h=>c({url:`${p}${h}/`,method:"DELETE",...m.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),r==="many"?P:P[0]},onSuccess:(...m)=>{let p=m[1],f=[T.getList(p.resource),T.getInfiniteList(p.resource)];n.forEach(d=>{f.push(T.getList(d)),f.push(T.getInfiniteList(d))}),E({queryClient:s,queryKeys:f}),_optionalChain([t, 'optionalAccess', _36 => _36.onSuccess])&&t.onSuccess(...m)},onError:(...m)=>{_optionalChain([t, 'optionalAccess', _37 => _37.onError])&&t.onError(...m),i()}});return{mutation:D,delete:async({resourceParams:m,undoMessage:p,...f})=>{let d={path:e,params:m},P=r==="many"?f.ids:[f.id];if(o.optimistic){let h=T.getOneArray(d,P),g=[T.getList(d)],R=[T.getInfiniteList(d)];n.forEach(b=>{h.push(...T.getOneArray(b,P)),g.push(T.getList(b)),R.push(T.getInfiniteList(b))}),u.current=await S(s,[...h,...g,...R]),z({queryClient:s,ids:P,queryKeysOne:h,queryKeysList:g,queryKeysInfiniteList:R})}if(o.undoable){let h=P.length>1;x.once("end",g=>{g?i():l({...f,resource:d})}),a({message:p||`Element${h?"s":""} deleted`,type:h?"delete-many":"delete-one"})}else l({...f,resource:d})}}},Qt= exports.useDeleteOne =e=>H({...e,type:"one"}),Rt= exports.useDeleteMany =e=>H({...e,type:"many"});var _=({resourcePath:e,mutationOptions:t,mode:o={optimistic:!0,undoable:!0},extraResources:n=[],type:r="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:a}=Q(),s=_reactquery.useQueryClient.call(void 0, ),u=_react.useRef.call(void 0, []),i=()=>{u.current.forEach(([m,p])=>{s.setQueryData(m,p)})},{mutate:l,...D}=_reactquery.useMutation.call(void 0, {...t,mutationKey:[r==="many"?"update-many":"update-one",e,..._optionalChain([t, 'optionalAccess', _38 => _38.mutationKey])?t.mutationKey:[]],mutationFn:async m=>{let p=`${y}/${F(m.resource)}/`;if(_optionalChain([t, 'optionalAccess', _39 => _39.mutationFn]))return await _optionalChain([t, 'optionalAccess', _40 => _40.mutationFn, 'call', _41 => _41({apiClient:c,variables:m,url:p})]);let f=r==="many"?m.ids:[m.id],d=await Promise.allSettled(f.map(h=>c({url:`${p}${h}/`,method:"PATCH",data:m.data,...m.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),r==="many"?P:P[0]},onSuccess:(...m)=>{let p=m[1];if(!o.optimistic){let f=r==="many"?p.ids:[p.id],d=[...T.getOneArray(p.resource,f),T.getList(p.resource),T.getInfiniteList(p.resource)];n.forEach(P=>{d.push(...T.getOneArray(P,f)),d.push(T.getList(P)),d.push(T.getInfiniteList(P))}),E({queryClient:s,queryKeys:d})}_optionalChain([t, 'optionalAccess', _42 => _42.onSuccess])&&t.onSuccess(...m)},onError:(...m)=>{_optionalChain([t, 'optionalAccess', _43 => _43.onError])&&t.onError(...m),i()}});return{mutation:D,update:async({resourceParams:m,undoMessage:p,...f})=>{let d={path:e,params:m},P=r==="many"?f.ids:[f.id];if(o.optimistic){let h=T.getOneArray(d,P),g=[T.getList(d)],R=[T.getInfiniteList(d)];n.forEach(b=>{h.push(...T.getOneArray(b,P)),g.push(T.getList(b)),R.push(T.getInfiniteList(b))}),u.current=await S(s,[...h,...g,...R]),N({queryClient:s,data:f.data,ids:P,queryKeysOne:h,queryKeysList:g,queryKeysInfiniteList:R})}if(o.undoable){let h=P.length>1;x.once("end",g=>{g?i():l({...f,resource:d})}),a({message:p||`Element${h?"s":""} updated`,type:h?"update-many":"update-one"})}else l({...f,resource:d})}}},Ut= exports.useUpdateOne =e=>_({...e,type:"one"}),Ot= exports.useUpdateMany =e=>_({...e,type:"many"});var Vt=({resourcePath:e,mutationOptions:t,extraResources:o=[]})=>{let{apiUrl:n,apiClient:r}=Q(),y=_reactquery.useQueryClient.call(void 0, ),{mutate:c,...a}=_reactquery.useMutation.call(void 0, {...t,mutationKey:["create",e,..._optionalChain([t, 'optionalAccess', _44 => _44.mutationKey])?t.mutationKey:[]],mutationFn:async u=>{let i=`${n}/${F(u.resource)}/`;return _optionalChain([t, 'optionalAccess', _45 => _45.mutationFn])?await _optionalChain([t, 'optionalAccess', _46 => _46.mutationFn, 'call', _47 => _47({apiClient:r,variables:u,url:i})]):await r({url:i,method:"POST",data:u.data,...u.apiClientParams})},onSuccess:(...u)=>{let i=u[0],l=u[1],{id:D}=i.data,C=[T.getOne(l.resource,D)],m=[T.getList(l.resource)],p=[T.getInfiniteList(l.resource)];o.forEach(f=>{C.push(T.getOne(f,D)),m.push(T.getList(f)),p.push(T.getInfiniteList(f))}),G({queryClient:y,queryKeys:C.map(f=>[...f,{}]),data:u[0]}),E({queryClient:y,queryKeys:[...m,...p]}),_optionalChain([t, 'optionalAccess', _48 => _48.onSuccess])&&t.onSuccess(...u)}});return{mutation:a,create:({resourceParams:u,...i})=>{c({...i,resource:{path:e,params:u}})}}};exports.CustomError = M; exports.RQWrapper = _e; exports.ToastBar = Be; exports.deleteItemsFromQueryCache = z; exports.fetcher = B; exports.getUrlFromResource = F; exports.helpersQueryKeys = T; exports.resolveToastValue = we; exports.toast = I; exports.updateItemsFromQueryCache = N; exports.useCreate = Vt; exports.useDeleteMany = Rt; exports.useDeleteOne = Qt; exports.useGetInfiniteList = nt; exports.useGetList = et; exports.useGetOne = yt; exports.useRQWrapperContext = Q; exports.useUpdateMany = Ot; exports.useUpdateOne = Ut;
//# sourceMappingURL=index.js.map