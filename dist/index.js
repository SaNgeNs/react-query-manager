export*from"@tanstack/react-query";import{useQuery as pe}from"@tanstack/react-query";import J from"eventemitter3";function L(e,t){let s={...e};if(e instanceof Object&&t instanceof Object){for(let u in t)if(u in e){let o=e[u],y=t[u];typeof o==typeof y&&(Array.isArray(o)&&Array.isArray(y)||o!==null&&!Array.isArray(o)&&typeof o=="object"&&!Array.isArray(y)&&typeof y=="object"||typeof o!="object"&&typeof y!="object")&&(typeof o=="object"&&o!==null&&!Array.isArray(o)?s[u]=L(o,y):s[u]=y)}}return s}var S=async(e,t)=>{let s=t.reduce((u,o)=>u.concat(e.getQueriesData({queryKey:o})),[]);return await Promise.all(s.map(([u])=>e.cancelQueries({queryKey:u}))),s};function U(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var v=new J,b={once:(e,t)=>{v.once(e,t)},emit:(e,t)=>{v.emit(e,t)}};var C=e=>{let t=e.path.replace(/{(\w+)}/g,(s,u)=>e.params[u].toString());return U(t)};import{QueryClient as oe,QueryClientProvider as ne}from"@tanstack/react-query";import{ReactQueryDevtools as ie}from"@tanstack/react-query-devtools";import K,{createContext as ue,useCallback as j,useContext as ce,useMemo as k}from"react";var M=class e extends Error{constructor(s,u,o){super(s);this.message=s;this.status=u;this.data=o;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(s).stack,this.stack=new Error().stack,console.error(this.message,this)}};function A(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:s}=e,u=e.data instanceof FormData,o=(()=>{let r=e.url;if(e.params){if(e.queryParamsSerializer)r+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(e.params).length>0){let i=[];for(let m in e.params)e.params.hasOwnProperty(m)&&(Array.isArray(e.params[m])?e.params[m].forEach(g=>{i.push(`${A(m)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${A(g)}`)}):i.push(`${A(m)}=${A(e.params[m])}`));r+=`?${i.join("&")}`}}let[a,n]=r.split("?");return a.charAt(a.length-1)!=="/"&&!n?`${a}/${`${n?`?${n}`:""}`}`:`${a}${n?`?${n}`:""}`})(),y=u?e.data:e.data?JSON.stringify(e.data):"",c={method:e.method,headers:{...!u&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...y&&{body:y},...e.options};return fetch(o,c).then(async r=>{let a=await(async()=>{try{let i=r.headers.get("Content-Type")?.toLowerCase()||"";return i.includes("application/json")?await r.json():i.includes("text/plain")||i.includes("text/csv")||i.includes("application/xml")||i.includes("text/xml")||i.includes("application/javascript")||i.includes("text/html")?await r.text():i.includes("multipart/form-data")?await r.formData():await r.blob()}catch(i){throw console.error("Error handling response:",i),i}})(),n={};return r.headers.forEach((i,m)=>{n[m]=i}),{status:r.status,statusText:r.statusText,headers:n,data:a}}).then(r=>{if(r.status<200||r.status>=300){let a=new M(`Request failed with status code: ${r.status}`,r.status,r.data);return s&&s(a,e),Promise.reject(a)}return t&&t(r,e),Promise.resolve(r)}).catch(r=>Promise.reject(new M(r.message)))};import q,{useCallback as Y}from"react";import{resolveValue as w,useToaster as X}from"react-hot-toast/headless";var Z=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function ee({id:e,className:t,style:s,onHeightUpdate:u,children:o}){let y=Y(c=>{if(c){let r=()=>{let{height:a}=c.getBoundingClientRect();u(e,a)};r(),new MutationObserver(r).observe(c,{subtree:!0,childList:!0,characterData:!0})}},[e,u]);return q.createElement("div",{ref:y,className:t,style:s},o)}var te=(e,t)=>{let s=e.includes("top"),u=s?{top:0}:{bottom:0},o=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Z()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(s?1:-1)}px)`,...u,...o}},O=16;function $({reverseOrder:e,position:t="top-center",toastOptions:s,gutter:u,children:o,containerStyle:y,containerClassName:c}){let{toasts:r,handlers:a}=X(s);return q.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...y},className:c,onMouseEnter:a.startPause,onMouseLeave:a.endPause},r.map(n=>{let i=n.position||t,m={...n,position:i},g=a.calculateOffset(m,{reverseOrder:e,gutter:u,defaultPosition:t}),Q=te(i,g);return q.createElement(ee,{id:m.id,key:m.id,onHeightUpdate:a.updateHeight,style:{...Q,pointerEvents:"auto"}},m.type==="custom"?w(n.message,m):o?o(m):q.createElement("div",{style:{display:n.visible?"flex":"none"}},w(m.message,m)))}))}import V from"react-hot-toast/headless";import{ToastBar as re,resolveValue as ae}from"react-hot-toast";var{remove:qe,...se}=V,I=Object.assign((...e)=>V(...e),se),Ie=re,Be=ae;var W=ue({apiUrl:"",apiClient:B,toastUndo:()=>{}}),F=()=>ce(W);function He({children:e,config:t={},apiUrl:s,apiClient:u=B,apiAuthorization:o,apiHeaders:y,apiOnSuccess:c,apiOnError:r,isDevTools:a,devToolsOptions:n,toast:i}){let m=k(()=>new oe({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}}),[]),g=j(p=>{let T=o?o():"",d=y?y():{},P=(...D)=>{c&&c(...D),p.onSuccess&&p.onSuccess(...D)},h=(...D)=>{r&&r(...D),p.onError&&p.onError(...D)};return u({...p,headers:p.headers?{...d,...p.headers}:d,authorization:p.authorization||T,onSuccess:P,onError:h})},[]),Q=j(p=>{let T=!1;I.dismiss();let d=()=>{T=!0,b.emit("end",!0),I.dismiss()},P=i?.customUndoContent?i?.customUndoContent({message:p.message,onUndo:d,type:p.type}):null;I.success(h=>(!h.visible&&!T&&(T=!0,b.emit("end",!1)),P||K.createElement(K.Fragment,null,p.message,K.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:d,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:i?.globalProps?.toastOptions?.duration||5e3})},[]),l=k(()=>({apiUrl:U(s),apiClient:g,toastUndo:Q}),[s,g,Q]);return K.createElement(ne,{client:m},K.createElement($,{...i?.globalProps},i?.wrapper),K.createElement(W.Provider,{value:l},e),a&&K.createElement(ie,{buttonPosition:"bottom-right",initialIsOpen:!1,...n}))}var Ze=({queryOptions:e,resource:t,params:s={},apiClientParams:u})=>{let{apiUrl:o,apiClient:y}=F();return pe({...e,queryKey:["get-list",t.path,t.params,s,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:r})=>{let a={resource:t,params:s,queryKey:r},n=`${o}/${C(a.resource)}/`;return e?.queryFn?await e?.queryFn({apiClient:y,variables:a,url:n}):await y({url:n,method:"GET",params:s,...u})}})};import{useInfiniteQuery as ye}from"@tanstack/react-query";var ot=({queryOptions:e,resource:t,params:s={},apiClientParams:u,pagination:o})=>{let{apiUrl:y,apiClient:c}=F();return ye({initialPageParam:1,getNextPageParam:(...a)=>{let n=a[0],i=Number(a[2]);if(n?.data?.length)return i+1},getPreviousPageParam:(...a)=>{let n=Number(a[2]);if(!(n<=1))return n-1},...e,queryKey:["get-infinite-list",t.path,t.params,o,s,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:a,pageParam:n})=>{let i={resource:t,params:{...s,[o.page[0]]:n,[o.per_page[0]]:o.per_page[1]},queryKey:a},m=`${y}/${C(i.resource)}/`;return e?.queryFn?await e?.queryFn({apiClient:c,variables:i,url:m}):await c({url:m,method:"GET",params:i.params,...u})}})};import{useQuery as me}from"@tanstack/react-query";var pt=({resource:e,id:t,queryOptions:s,params:u={},apiClientParams:o})=>{let{apiUrl:y,apiClient:c}=F();return me({...s,queryKey:["get-one",e.path,e.params,String(t),u,...s?.queryKey?s.queryKey:[]],queryFn:async({queryKey:a})=>{let n={id:t,resource:e,params:u,queryKey:a},i=`${y}/${C(n.resource)}/`;return s?.queryFn?await s?.queryFn({apiClient:c,variables:n,url:i}):await c({url:`${i}${n.id}/`,method:"GET",params:u,...o})}})};import{useMutation as le,useQueryClient as Te}from"@tanstack/react-query";import{useRef as he}from"react";var z=({queryClient:e,ids:t,queryKeysOne:s,queryKeysList:u,queryKeysInfiniteList:o})=>{let y=c=>!c||!(c.data instanceof Array)?c:{...c,data:c.data.filter(r=>!t.some(a=>String(a)===String(r.id)))};s&&s.forEach(c=>{e.removeQueries({queryKey:c})}),u&&u.forEach(c=>{e.setQueriesData({queryKey:c},y)}),o&&o.forEach(c=>{e.setQueriesData({queryKey:c},r=>r&&{...r,pages:r.pages.map(y)})})},N=({queryClient:e,data:t,ids:s,queryKeysOne:u,queryKeysList:o,queryKeysInfiniteList:y})=>{let c=r=>!r||!(r.data instanceof Array)?r:{...r,data:r.data.map(a=>s.some(n=>String(n)===String(a.id))?L(a,t):a)};u&&u.forEach(r=>{e.setQueriesData({queryKey:r},a=>!a||!(a.data instanceof Object)||!(t instanceof Object)?a:{...a,data:L(a.data,t)})}),o&&o.forEach(r=>{e.setQueriesData({queryKey:r},c)}),y&&y.forEach(r=>{e.setQueriesData({queryKey:r},a=>a&&{...a,pages:a.pages.map(c)})})},f={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(s=>["get-one",e.path,e.params,String(s)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params]};var E=({queryClient:e,queryKeys:t})=>{t.forEach(s=>{e.invalidateQueries({queryKey:s})})},G=({queryClient:e,queryKeys:t,data:s})=>{t.forEach(u=>{e.setQueryData(u,s)})};var H=({resourcePath:e,mutationOptions:t,mode:s={optimistic:!0,undoable:!0},extraResources:u=[],type:o="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:r}=F(),a=Te(),n=he([]),i=()=>{n.current.forEach(([l,p])=>{a.setQueryData(l,p)})},{mutate:m,...g}=le({...t,mutationKey:[o==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async l=>{let p=`${y}/${C(l.resource)}/`;if(t?.mutationFn)return await t?.mutationFn({apiClient:c,variables:l,url:p});let T=o==="many"?l.ids:[l.id],d=await Promise.allSettled(T.map(h=>c({url:`${p}${h}/`,method:"DELETE",...l.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),o==="many"?P:P[0]},onSuccess:(...l)=>{let p=l[1],T=[f.getList(p.resource),f.getInfiniteList(p.resource)];u.forEach(d=>{T.push(f.getList(d)),T.push(f.getInfiniteList(d))}),E({queryClient:a,queryKeys:T}),t?.onSuccess&&t.onSuccess(...l)},onError:(...l)=>{t?.onError&&t.onError(...l),i()}});return{mutation:g,delete:async({resourceParams:l,undoMessage:p,...T})=>{let d={path:e,params:l},P=o==="many"?T.ids:[T.id];if(s.optimistic){let h=f.getOneArray(d,P),D=[f.getList(d)],R=[f.getInfiniteList(d)];u.forEach(x=>{h.push(...f.getOneArray(x,P)),D.push(f.getList(x)),R.push(f.getInfiniteList(x))}),n.current=await S(a,[...h,...D,...R]),z({queryClient:a,ids:P,queryKeysOne:h,queryKeysList:D,queryKeysInfiniteList:R})}if(s.undoable){let h=P.length>1;b.once("end",D=>{D?i():m({...T,resource:d})}),r({message:p||`Element${h?"s":""} deleted`,type:h?"delete-many":"delete-one"})}else m({...T,resource:d})}}},Ft=e=>H({...e,type:"one"}),Qt=e=>H({...e,type:"many"});import{useMutation as fe,useQueryClient as de}from"@tanstack/react-query";import{useRef as Pe}from"react";var _=({resourcePath:e,mutationOptions:t,mode:s={optimistic:!0,undoable:!0},extraResources:u=[],type:o="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:r}=F(),a=de(),n=Pe([]),i=()=>{n.current.forEach(([l,p])=>{a.setQueryData(l,p)})},{mutate:m,...g}=fe({...t,mutationKey:[o==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async l=>{let p=`${y}/${C(l.resource)}/`;if(t?.mutationFn)return await t?.mutationFn({apiClient:c,variables:l,url:p});let T=o==="many"?l.ids:[l.id],d=await Promise.allSettled(T.map(h=>c({url:`${p}${h}/`,method:"PATCH",data:l.data,...l.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),o==="many"?P:P[0]},onSuccess:(...l)=>{let p=l[1];if(!s.optimistic){let T=o==="many"?p.ids:[p.id],d=[...f.getOneArray(p.resource,T),f.getList(p.resource),f.getInfiniteList(p.resource)];u.forEach(P=>{d.push(...f.getOneArray(P,T)),d.push(f.getList(P)),d.push(f.getInfiniteList(P))}),E({queryClient:a,queryKeys:d})}t?.onSuccess&&t.onSuccess(...l)},onError:(...l)=>{t?.onError&&t.onError(...l),i()}});return{mutation:g,update:async({resourceParams:l,undoMessage:p,...T})=>{let d={path:e,params:l},P=o==="many"?T.ids:[T.id];if(s.optimistic){let h=f.getOneArray(d,P),D=[f.getList(d)],R=[f.getInfiniteList(d)];u.forEach(x=>{h.push(...f.getOneArray(x,P)),D.push(f.getList(x)),R.push(f.getInfiniteList(x))}),n.current=await S(a,[...h,...D,...R]),N({queryClient:a,data:T.data,ids:P,queryKeysOne:h,queryKeysList:D,queryKeysInfiniteList:R})}if(s.undoable){let h=P.length>1;b.once("end",D=>{D?i():m({...T,resource:d})}),r({message:p||`Element${h?"s":""} updated`,type:h?"update-many":"update-one"})}else m({...T,resource:d})}}},Ut=e=>_({...e,type:"one"}),At=e=>_({...e,type:"many"});import{useMutation as De,useQueryClient as ge}from"@tanstack/react-query";var $t=({resourcePath:e,mutationOptions:t,extraResources:s=[]})=>{let{apiUrl:u,apiClient:o}=F(),y=ge(),{mutate:c,...r}=De({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async n=>{let i=`${u}/${C(n.resource)}/`;return t?.mutationFn?await t?.mutationFn({apiClient:o,variables:n,url:i}):await o({url:i,method:"POST",data:n.data,...n.apiClientParams})},onSuccess:(...n)=>{let i=n[0],m=n[1],{id:g}=i.data,Q=[f.getOne(m.resource,g)],l=[f.getList(m.resource)],p=[f.getInfiniteList(m.resource)];s.forEach(T=>{Q.push(f.getOne(T,g)),l.push(f.getList(T)),p.push(f.getInfiniteList(T))}),G({queryClient:y,queryKeys:Q.map(T=>[...T,{}]),data:n[0]}),E({queryClient:y,queryKeys:[...l,...p]}),t?.onSuccess&&t.onSuccess(...n)}});return{mutation:r,create:({resourceParams:n,...i})=>{c({...i,resource:{path:e,params:n}})}}};export{M as CustomError,He as RQWrapper,Ie as ToastBar,z as deleteItemsFromQueryCache,B as fetcher,C as getUrlFromResource,f as helpersQueryKeys,Be as resolveToastValue,I as toast,N as updateItemsFromQueryCache,$t as useCreate,Qt as useDeleteMany,Ft as useDeleteOne,ot as useGetInfiniteList,Ze as useGetList,pt as useGetOne,F as useRQWrapperContext,At as useUpdateMany,Ut as useUpdateOne};
//# sourceMappingURL=index.js.map