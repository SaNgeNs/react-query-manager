var U=class e extends Error{constructor(r,a,s){super(r);this.message=r;this.status=a;this.data=s;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(r).stack,this.stack=new Error().stack,console.error(this.message,this)}};var oe=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([a,s])=>{(s||typeof s=="boolean"||typeof s=="number")&&(t[a]=s)}),t}return{}},v=e=>encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]"),j=({onSuccess:e,onError:t,context:r,...a})=>{let s=a.data instanceof FormData,i=(()=>{let n=a.url;if(a.params){let y=oe(a.params);if(a.queryParamsSerializer)n+=`?${a.queryParamsSerializer(a.params)}`;else if(Object.keys(y).length>0){let p=[];for(let P in y)y.hasOwnProperty(P)&&(Array.isArray(y[P])?y[P].forEach(g=>{p.push(`${v(P)}${a.queryArrayParamStyle==="indexedArray"?"[]":""}=${v(g)}`)}):p.push(`${v(P)}=${v(y[P])}`));n+=`?${p.join("&")}`}}let[c,T]=n.split("?");return`${c}${T?`?${T}`:""}`})(),o=s?a.data:a.data?JSON.stringify(a.data):"",u={method:a.method,headers:{...!s&&{"Content-Type":"application/json"},...a.authorization&&{Authorization:a.authorization},...a.headers},...o&&{body:o},...a.options};return fetch(i,u).then(async n=>{let c=await(async()=>{try{let y=n.headers.get("Content-Length"),p=n.headers.get("Content-Type")?.toLowerCase();return n.status===204||n.status===304||y==="0"||!p?null:p.includes("application/json")?await n.json():p.includes("text/plain")||p.includes("text/csv")||p.includes("application/xml")||p.includes("text/xml")||p.includes("application/javascript")||p.includes("text/html")?await n.text():p.includes("multipart/form-data")?await n.formData():await n.blob()}catch{return null}})(),T={};return n.headers.forEach((y,p)=>{T[p]=y}),{status:n.status,statusText:n.statusText,headers:T,data:c}}).then(n=>{if(n.status<200||n.status>=300){let c=new U(`Request failed with status code: ${n.status}`,n.status,n.data);return t&&t(c,a,r),Promise.reject(c)}return e&&e(n,a,r),Promise.resolve(n)}).catch(n=>Promise.reject(new U(n.message)))};export*from"@tanstack/react-query";import{useQuery as xe}from"@tanstack/react-query";function w(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var C=(e,t)=>{let r=w(e.path.replace(/{(\w+)}/g,(a,s)=>e.params[s].toString()));return t?`${r}/`:r};import{QueryClient as de,QueryClientProvider as he}from"@tanstack/react-query";import{ReactQueryDevtools as Pe}from"@tanstack/react-query-devtools";import F,{createContext as De,useCallback as H,useContext as Qe,useMemo as J}from"react";import I,{useCallback as ie}from"react";import{resolveValue as W,useToaster as ue}from"react-hot-toast/headless";var ye=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"&&window.matchMedia){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function pe({id:e,className:t,style:r,onHeightUpdate:a,children:s}){let i=ie(o=>{if(o){let u=()=>{let{height:n}=o.getBoundingClientRect();a(e,n)};u(),new MutationObserver(u).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[e,a]);return I.createElement("div",{"data-toast-id":e,ref:i,className:t,style:r},s)}var ce=(e,t)=>{let r=e.includes("top"),a=r?{top:0}:{bottom:0},s=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ye()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...a,...s}},V=16;function _({reverseOrder:e,position:t="top-center",toastOptions:r,gutter:a,children:s,containerStyle:i,containerClassName:o}){let{toasts:u,handlers:n}=ue(r);return I.createElement("div",{style:{position:"fixed",zIndex:9999,top:V,left:V,right:V,bottom:V,pointerEvents:"none",...i},className:o,onMouseEnter:n.startPause,onMouseLeave:n.endPause},u.map(c=>{let T=c.position||t,y={...c,position:T},p=n.calculateOffset(y,{reverseOrder:e,gutter:a,defaultPosition:t}),P=ce(T,p),g=s;return I.createElement(pe,{id:y.id,key:y.id,onHeightUpdate:n.updateHeight,style:{...P,pointerEvents:"auto"}},y.type==="custom"?W(c.message,y):g?I.createElement(g,{...y}):I.createElement("div",{style:{display:c.visible?"flex":"none"}},W(y.message,y)))}))}import z from"react-hot-toast/headless";import{ToastBar as me,resolveValue as le}from"react-hot-toast";var{remove:ze,...Te}=z,$=Object.assign((...e)=>z(...e),Te),Ge=me,He=le;import fe from"eventemitter3";var G=new fe,S={once:(e,t)=>{G.once(e,t)},emit:(e,t)=>{G.emit(e,t)}};var q=process.env.NODE_ENV==="test";var N={queryClient:{}},E=()=>N.queryClient;var Y=De({apiUrl:"",apiEnsureTrailingSlash:!1,apiClient:j,toastUndo:()=>{}}),b=()=>Qe(Y);function lt({children:e,config:t={},apiUrl:r,apiClient:a=j,apiEnsureTrailingSlash:s=!1,apiAuthorization:i,apiHeaders:o,apiOnSuccess:u,apiOnError:n,isDevTools:c,devToolsOptions:T,toast:y}){let p=J(()=>{let x=new de({...t});return N.queryClient=x,x},[]),P=H(x=>{let m=i?i():"",l=o?o():{},D=(...d)=>{u&&u(...d),x.onSuccess&&x.onSuccess(...d)},f=(...d)=>{n&&n(...d),x.onError&&x.onError(...d)};return a({...x,headers:x.headers?{...l,...x.headers}:l,authorization:x.authorization||m,onSuccess:D,onError:f})},[]),g=H(x=>{let m=!1;$.dismiss();let l=()=>{m=!0,S.emit("end",!0),$.dismiss()};q||$.success(D=>{let f=y?.CustomUndoContent;return!D.visible&&!m&&(m=!0,S.emit("end",!1)),f?F.createElement(f,{message:x.message,onUndo:l,type:x.type,toast:D}):F.createElement(F.Fragment,null,x.message,F.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:l,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))},{duration:y?.globalProps?.toastOptions?.duration||5e3})},[]),K=J(()=>({apiUrl:w(r),apiClient:P,apiEnsureTrailingSlash:s,toastUndo:g}),[r,P,g,s]);return F.createElement(he,{client:p},!q&&F.createElement(_,{...y?.globalProps},y?.CustomContent),F.createElement(Y.Provider,{value:K},e),c&&F.createElement(Pe,{buttonPosition:"bottom-right",initialIsOpen:!1,...T}))}var Pt=({queryOptions:e,resource:t,params:r={},apiClientParams:a})=>{let{apiUrl:s,apiClient:i,apiEnsureTrailingSlash:o}=b();return xe({...e,queryKey:["get-list",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:n})=>{let c={resource:t,params:r,queryKey:n},T=`${s}/${C(c.resource,o)}`;return e?.queryFn?await e?.queryFn({apiClient:i,apiUrl:s,variables:c,url:T}):await i({url:T,method:"GET",params:r,...a})}})};import{useInfiniteQuery as ge}from"@tanstack/react-query";var Ct=({queryOptions:e,resource:t,params:r={},apiClientParams:a,pagination:s})=>{let{apiUrl:i,apiClient:o,apiEnsureTrailingSlash:u}=b();return ge({initialPageParam:1,getNextPageParam:(...c)=>{let T=c[0],y=Number(c[2]);if(T?.data?.length)return y+1},getPreviousPageParam:(...c)=>{let T=Number(c[2]);if(!(T<=1))return T-1},...e,queryKey:["get-infinite-list",t.path,t.params,s,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:c,pageParam:T})=>{let y={resource:t,params:{...r,[s.page[0]]:T,[s.per_page[0]]:s.per_page[1]},queryKey:c},p=`${i}/${C(y.resource,u)}`;return e?.queryFn?await e?.queryFn({apiClient:o,apiUrl:i,variables:y,url:p}):await o({url:p,method:"GET",params:y.params,...a})}})};import{useQuery as Ee}from"@tanstack/react-query";var Mt=({resource:e,id:t,queryOptions:r,params:a={},apiClientParams:s})=>{let{apiUrl:i,apiClient:o,apiEnsureTrailingSlash:u}=b();return Ee({...r,queryKey:["get-one",e.path,e.params,String(t),a,...r?.queryKey?r.queryKey:[]],queryFn:async({queryKey:c})=>{let T={id:t,resource:e,params:a,queryKey:c},y=`${i}/${C(T.resource,!0)}`;return r?.queryFn?await r?.queryFn({apiClient:o,apiUrl:i,variables:T,url:y}):await o({url:`${y}${T.id}${u?"/":""}`,method:"GET",params:a,...s})}})};import{useMutation as be,useQueryClient as Re}from"@tanstack/react-query";import{useRef as Ke}from"react";var X=({data:e,queryKeysOne:t})=>{let r=E();t&&t.forEach(a=>{r.setQueryData(a,e)})};var Z=({data:e,queryKeysList:t,queryKeysInfiniteList:r,cacheAddItemTo:a="start"})=>{let s=E(),i=o=>!o||!(o.data instanceof Array)?o:{...o,data:a==="start"?[...e,...o.data]:[...o.data,...e]};t&&t.forEach(o=>{s.setQueriesData({queryKey:o},i)}),r&&r.forEach(o=>{s.setQueriesData({queryKey:o},u=>u&&{...u,pages:u.pages.map(i)})})};var ee=({queryKeys:e})=>{let t=E();e.forEach(r=>{t.removeQueries({queryKey:r})})};var te=({ids:e,queryKeysOne:t,queryKeysList:r,queryKeysInfiniteList:a})=>{let s=E(),i=o=>!o||!(o.data instanceof Array)?o:{...o,data:o.data.filter(u=>!e.some(n=>String(n)===String(u.id)))};t&&ee({queryKeys:t}),r&&r.forEach(o=>{s.setQueriesData({queryKey:o},i)}),a&&a.forEach(o=>{s.setQueriesData({queryKey:o},u=>u&&{...u,pages:u.pages.map(i)})})};var h={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(r=>["get-one",e.path,e.params,String(r)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params],getDataQuery:e=>["query-data",e.path,e.params]};function A(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){let r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(let s of r){let i=e[s],o=t[s];if(i!==o&&!A(i,o))return!1}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]&&!A(e[r],t[r]))return!1;return!0}return e===t}var Nt=({queryKeys:e})=>{E().invalidateQueries({predicate:r=>{let a=r.queryKey;return e.some(s=>s.every(i=>a.some(o=>A(o,i))))}})};var Gt=({queryKeys:e})=>{E().removeQueries({predicate:r=>{let a=r.queryKey;return e.some(s=>s.every(i=>a.some(o=>A(o,i))))}})};var O=({queryKeys:e})=>{let t=E();e.forEach(r=>{t.invalidateQueries({queryKey:r})})};function re(e){return!Number.isNaN(Number(e))}function Ce(e,t){return re(e)&&re(t)}function B(e,t){let r={...e};if(e instanceof Object&&t instanceof Object){for(let a in t)if(a in e){let s=e[a],i=t[a],o=typeof s==typeof i&&(Array.isArray(s)&&Array.isArray(i)||s!==null&&!Array.isArray(s)&&typeof s=="object"&&!Array.isArray(i)&&typeof i=="object"||typeof s!="object"&&typeof i!="object"),u=Ce(s,i);(o||u)&&(typeof s=="object"&&s!==null&&!Array.isArray(s)?r[a]=B(s,i):r[a]=i)}}return r}var ae=({data:e,ids:t,queryKeysOne:r,queryKeysList:a,queryKeysInfiniteList:s})=>{let i=E(),o=u=>!u||!(u.data instanceof Array)?u:{...u,data:u.data.map(n=>t.some(c=>String(c)===String(n.id))?B(n,e):n)};r&&r.forEach(u=>{i.setQueriesData({queryKey:u},n=>!n||!(n.data instanceof Object)||!(e instanceof Object)?n:{...n,data:B(n.data,e)})}),a&&a.forEach(u=>{i.setQueriesData({queryKey:u},o)}),s&&s.forEach(u=>{i.setQueriesData({queryKey:u},n=>n&&{...n,pages:n.pages.map(o)})})};var k=async e=>{let t=E(),r=e.reduce((a,s)=>a.concat(t.getQueriesData({queryKey:s})),[]);return await Promise.all(r.map(([a])=>t.cancelQueries({queryKey:a}))),r};var se=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:a=[],shouldUpdateCurrentResource:s=!0,isInvalidateCache:i=!0,type:o="many"})=>{let{apiUrl:u,apiClient:n,apiEnsureTrailingSlash:c,toastUndo:T}=b(),y=Re(),p=Ke([]),P=()=>{p.current.forEach(([m,l])=>{y.setQueryData(m,l)})},{mutate:g,...K}=be({...t,mutationKey:[o==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let l=`${u}/${C(m.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:n,apiUrl:u,variables:m,url:l});let D=o==="many"?m.ids:[m.id],f=await Promise.allSettled(D.map(Q=>n({url:`${l}${Q}${c?"/":""}`,method:"DELETE",...m.apiClientParams}))),d=[];return f.forEach(Q=>{if(Q.status==="fulfilled")d.push(Q.value);else throw Q.reason}),o==="many"?d:d[0]},onSuccess:(...m)=>{let l=m[1],D=[h.getList(l.resource),h.getInfiniteList(l.resource)];a.forEach(f=>{D.push(h.getList(f)),D.push(h.getInfiniteList(f))}),i&&O({queryKeys:D}),t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),P()}});return{mutation:K,delete:async({resourceParams:m,undoMessage:l,...D})=>{let f={path:e,params:m},d=o==="many"?D.ids:[D.id];if(r.optimistic){let Q=s?h.getOneArray(f,d):[],R=s?[h.getList(f)]:[],M=s?[h.getInfiniteList(f)]:[];a.forEach(L=>{Q.push(...h.getOneArray(L,d)),R.push(h.getList(L)),M.push(h.getInfiniteList(L))}),p.current=await k([...Q,...R,...M]),te({ids:d,queryKeysOne:Q,queryKeysList:R,queryKeysInfiniteList:M})}if(r.undoable&&!q){let Q=d.length>1;S.once("end",R=>{R?P():g({...D,resource:f})}),T({message:l||`Element${Q?"s":""} deleted`,type:Q?"delete-many":"delete-one"})}else g({...D,resource:f})}}},gr=e=>se({...e,type:"one"}),Er=e=>se({...e,type:"many"});import{useMutation as Fe,useQueryClient as Me}from"@tanstack/react-query";import{useRef as Le}from"react";var ne=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:a=[],shouldUpdateCurrentResource:s=!0,isInvalidateCache:i=!0,type:o="many"})=>{let{apiUrl:u,apiClient:n,apiEnsureTrailingSlash:c,toastUndo:T}=b(),y=Me(),p=Le([]),P=()=>{p.current.forEach(([m,l])=>{y.setQueryData(m,l)})},{mutate:g,...K}=Fe({...t,mutationKey:[o==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let l=`${u}/${C(m.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:n,apiUrl:u,variables:m,url:l});let D=o==="many"?m.ids:[m.id],f=await Promise.allSettled(D.map(Q=>n({url:`${l}${Q}${c?"/":""}`,method:"PATCH",data:m.data,...m.apiClientParams}))),d=[];return f.forEach(Q=>{if(Q.status==="fulfilled")d.push(Q.value);else throw Q.reason}),o==="many"?d:d[0]},onSuccess:(...m)=>{let l=m[1];if(i){let D=o==="many"?l.ids:[l.id],f=[...h.getOneArray(l.resource,D),h.getList(l.resource),h.getInfiniteList(l.resource)];a.forEach(d=>{f.push(...h.getOneArray(d,D)),f.push(h.getList(d)),f.push(h.getInfiniteList(d))}),O({queryKeys:f})}t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),P()}});return{mutation:K,update:async({resourceParams:m,undoMessage:l,...D})=>{let f={path:e,params:m},d=o==="many"?D.ids:[D.id];if(r.optimistic){let Q=s?h.getOneArray(f,d):[],R=s?[h.getList(f)]:[],M=s?[h.getInfiniteList(f)]:[];a.forEach(L=>{Q.push(...h.getOneArray(L,d)),R.push(h.getList(L)),M.push(h.getInfiniteList(L))}),p.current=await k([...Q,...R,...M]),ae({data:D.data,ids:d,queryKeysOne:Q,queryKeysList:R,queryKeysInfiniteList:M})}if(r.undoable&&!q){let Q=d.length>1;S.once("end",R=>{R?P():g({...D,resource:f})}),T({message:l||`Element${Q?"s":""} updated`,type:Q?"update-many":"update-one"})}else g({...D,resource:f})}}},Ar=e=>ne({...e,type:"one"}),Or=e=>ne({...e,type:"many"});import{useMutation as Se}from"@tanstack/react-query";var Vr=({resourcePath:e,mutationOptions:t,extraResources:r=[],shouldUpdateCurrentResource:a=!0,cacheAddItemTo:s="start",isInvalidateCache:i=!0})=>{let{apiUrl:o,apiClient:u,apiEnsureTrailingSlash:n}=b(),{mutate:c,...T}=Se({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async p=>{let P=`${o}/${C(p.resource,n)}`;return t?.mutationFn?await t?.mutationFn({apiClient:u,apiUrl:o,variables:p,url:P}):await u({url:P,method:"POST",data:p.data,...p.apiClientParams})},onSuccess:(...p)=>{let P=p[0];if(P){let g=p[1],K=a?[h.getList(g.resource)]:[],x=a?[h.getInfiniteList(g.resource)]:[];r.forEach(l=>{K.push(h.getList(l)),x.push(h.getInfiniteList(l))});let m=Array.isArray(P)?P:[P];m.forEach(l=>{if(l){let{id:D}=l.data,f=a?[h.getOne(g.resource,D)]:[];r.forEach(d=>{f.push(h.getOne(d,D))}),X({data:l,queryKeysOne:f.map(d=>[...d,{}])})}}),Z({data:m.map(l=>l?.data||{}),cacheAddItemTo:s,queryKeysInfiniteList:x,queryKeysList:K}),i&&O({queryKeys:[...K,...x]})}t?.onSuccess&&t.onSuccess(...p)}});return{mutation:T,create:({resourceParams:p,...P})=>{c({...P,resource:{path:e,params:p}})}}};import{useQuery as qe}from"@tanstack/react-query";var Wr=({queryOptions:e,resource:t,params:r={},apiClientParams:a})=>{let{apiUrl:s,apiClient:i,apiEnsureTrailingSlash:o}=b();return qe({...e,queryKey:["query-data",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:n})=>{let c={resource:t,params:r,queryKey:n},T=`${s}/${C(c.resource,o)}`;return e?.queryFn?await e?.queryFn({apiClient:i,apiUrl:s,variables:c,url:T}):await i({url:T,method:"GET",params:r,...a})}})};import{useMutation as Ae}from"@tanstack/react-query";var Jr=({resourcePath:e,mutationOptions:t})=>{let{apiUrl:r,apiClient:a,apiEnsureTrailingSlash:s}=b(),{mutate:i,...o}=Ae({...t,mutationKey:["mutate-data",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async n=>{let c=`${r}/${C(n.resource,s)}`;return t?.mutationFn?await t?.mutationFn({apiClient:a,apiUrl:r,variables:n,url:c}):await a({url:c,data:n.data,...n.apiClientParams})}});return{mutation:o,mutate:async({resourceParams:n,...c})=>{i({...c,resource:{path:e,params:n}})}}};export{U as CustomError,lt as RQWrapper,Ge as ToastBar,X as addItemToQueryCache,Z as addItemsToListQueryCache,te as deleteItemsFromQueryCache,j as fetcher,C as getUrlFromResource,h as helpersQueryKeys,Nt as invalidateMatchingQueries,O as invalidateQueries,Gt as removeMatchingQueries,ee as removeQueries,He as resolveToastValue,$ as toast,ae as updateItemsFromQueryCache,Vr as useCreate,Jr as useDataMutate,Wr as useDataQuery,Er as useDeleteMany,gr as useDeleteOne,Ct as useGetInfiniteList,Pt as useGetList,Mt as useGetOne,b as useRQWrapperContext,Or as useUpdateMany,Ar as useUpdateOne};
//# sourceMappingURL=index.mjs.map