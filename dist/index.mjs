export*from"@tanstack/react-query";import{useQuery as fe}from"@tanstack/react-query";function A(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var g=(e,t)=>{let a=A(e.path.replace(/{(\w+)}/g,(n,s)=>e.params[s].toString()));return t?`${a}/`:a};import{QueryClient as pe,QueryClientProvider as ce}from"@tanstack/react-query";import{ReactQueryDevtools as me}from"@tanstack/react-query-devtools";import b,{createContext as le,useCallback as N,useContext as Te,useMemo as G}from"react";var S=class e extends Error{constructor(a,n,s){super(a);this.message=a;this.status=n;this.data=s;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(a).stack,this.stack=new Error().stack,console.error(this.message,this)}};var ee=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([n,s])=>{(s||typeof s=="boolean"||typeof s=="number")&&(t[n]=s)}),t}return{}};function U(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:a}=e,n=e.data instanceof FormData,s=(()=>{let r=e.url;if(e.params){let y=ee(e.params);if(e.queryParamsSerializer)r+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(y).length>0){let c=[];for(let Q in y)y.hasOwnProperty(Q)&&(Array.isArray(y[Q])?y[Q].forEach(P=>{c.push(`${U(Q)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${U(P)}`)}):c.push(`${U(Q)}=${U(y[Q])}`));r+=`?${c.join("&")}`}}let[o,m]=r.split("?");return`${o}${m?`?${m}`:""}`})(),u=n?e.data:e.data?JSON.stringify(e.data):"",i={method:e.method,headers:{...!n&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...u&&{body:u},...e.options};return fetch(s,i).then(async r=>{let o=await(async()=>{try{let y=r.headers.get("Content-Type")?.toLowerCase()||"";return y.includes("application/json")?await r.json():y.includes("text/plain")||y.includes("text/csv")||y.includes("application/xml")||y.includes("text/xml")||y.includes("application/javascript")||y.includes("text/html")?await r.text():y.includes("multipart/form-data")?await r.formData():await r.blob()}catch(y){throw console.error("Error handling response:",y),y}})(),m={};return r.headers.forEach((y,c)=>{m[c]=y}),{status:r.status,statusText:r.statusText,headers:m,data:o}}).then(r=>{if(r.status<200||r.status>=300){let o=new S(`Request failed with status code: ${r.status}`,r.status,r.data);return a&&a(o,e),Promise.reject(o)}return t&&t(r,e),Promise.resolve(r)}).catch(r=>Promise.reject(new S(r.message)))};import I,{useCallback as te}from"react";import{resolveValue as V,useToaster as ae}from"react-hot-toast/headless";var re=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function se({id:e,className:t,style:a,onHeightUpdate:n,children:s}){let u=te(i=>{if(i){let r=()=>{let{height:o}=i.getBoundingClientRect();n(e,o)};r(),new MutationObserver(r).observe(i,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return I.createElement("div",{ref:u,className:t,style:a},s)}var ne=(e,t)=>{let a=e.includes("top"),n=a?{top:0}:{bottom:0},s=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:re()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(a?1:-1)}px)`,...n,...s}},O=16;function k({reverseOrder:e,position:t="top-center",toastOptions:a,gutter:n,children:s,containerStyle:u,containerClassName:i}){let{toasts:r,handlers:o}=ae(a);return I.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...u},className:i,onMouseEnter:o.startPause,onMouseLeave:o.endPause},r.map(m=>{let y=m.position||t,c={...m,position:y},Q=o.calculateOffset(c,{reverseOrder:e,gutter:n,defaultPosition:t}),P=ne(y,Q);return I.createElement(se,{id:c.id,key:c.id,onHeightUpdate:o.updateHeight,style:{...P,pointerEvents:"auto"}},c.type==="custom"?V(m.message,c):s?s(c):I.createElement("div",{style:{display:m.visible?"flex":"none"}},V(c.message,c)))}))}import W from"react-hot-toast/headless";import{ToastBar as oe,resolveValue as ie}from"react-hot-toast";var{remove:Be,...ue}=W,q=Object.assign((...e)=>W(...e),ue),Ve=oe,ke=ie;import ye from"eventemitter3";var z=new ye,M={once:(e,t)=>{z.once(e,t)},emit:(e,t)=>{z.emit(e,t)}};var H=le({apiUrl:"",apiEnsureTrailingSlash:!1,apiClient:B,toastUndo:()=>{}}),C=()=>Te(H);function rt({children:e,config:t={},apiUrl:a,apiClient:n=B,apiEnsureTrailingSlash:s=!1,apiAuthorization:u,apiHeaders:i,apiOnSuccess:r,apiOnError:o,isDevTools:m,devToolsOptions:y,toast:c}){let Q=G(()=>new pe({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}}),[]),P=N(p=>{let d=u?u():"",l=i?i():{},T=(...D)=>{r&&r(...D),p.onSuccess&&p.onSuccess(...D)},h=(...D)=>{o&&o(...D),p.onError&&p.onError(...D)};return n({...p,headers:p.headers?{...l,...p.headers}:l,authorization:p.authorization||d,onSuccess:T,onError:h})},[]),E=N(p=>{let d=!1;q.dismiss();let l=()=>{d=!0,M.emit("end",!0),q.dismiss()},T=c?.customUndoContent?c?.customUndoContent({message:p.message,onUndo:l,type:p.type}):null;q.success(h=>(!h.visible&&!d&&(d=!0,M.emit("end",!1)),T||b.createElement(b.Fragment,null,p.message,b.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:l,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:c?.globalProps?.toastOptions?.duration||5e3})},[]),R=G(()=>({apiUrl:A(a),apiClient:P,apiEnsureTrailingSlash:s,toastUndo:E}),[a,P,E,s]),x=c?.wrapper||(()=>null);return b.createElement(ce,{client:Q},b.createElement(k,{...c?.globalProps},p=>b.createElement(x,{...p})),b.createElement(H.Provider,{value:R},e),m&&b.createElement(me,{buttonPosition:"bottom-right",initialIsOpen:!1,...y}))}var ut=({queryOptions:e,resource:t,params:a={},apiClientParams:n})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:i}=C();return fe({...e,queryKey:["get-list",t.path,t.params,a,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:o})=>{let m={resource:t,params:a,queryKey:o},y=`${s}/${g(m.resource,i)}`;return e?.queryFn?await e?.queryFn({apiClient:u,apiUrl:s,variables:m,url:y}):await u({url:y,method:"GET",params:a,...n})}})};import{useInfiniteQuery as de}from"@tanstack/react-query";var Tt=({queryOptions:e,resource:t,params:a={},apiClientParams:n,pagination:s})=>{let{apiUrl:u,apiClient:i,apiEnsureTrailingSlash:r}=C();return de({initialPageParam:1,getNextPageParam:(...m)=>{let y=m[0],c=Number(m[2]);if(y?.data?.length)return c+1},getPreviousPageParam:(...m)=>{let y=Number(m[2]);if(!(y<=1))return y-1},...e,queryKey:["get-infinite-list",t.path,t.params,s,a,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:m,pageParam:y})=>{let c={resource:t,params:{...a,[s.page[0]]:y,[s.per_page[0]]:s.per_page[1]},queryKey:m},Q=`${u}/${g(c.resource,r)}`;return e?.queryFn?await e?.queryFn({apiClient:i,apiUrl:u,variables:c,url:Q}):await i({url:Q,method:"GET",params:c.params,...n})}})};import{useQuery as he}from"@tanstack/react-query";var Dt=({resource:e,id:t,queryOptions:a,params:n={},apiClientParams:s})=>{let{apiUrl:u,apiClient:i,apiEnsureTrailingSlash:r}=C();return he({...a,queryKey:["get-one",e.path,e.params,String(t),n,...a?.queryKey?a.queryKey:[]],queryFn:async({queryKey:m})=>{let y={id:t,resource:e,params:n,queryKey:m},c=`${u}/${g(y.resource,!0)}`;return a?.queryFn?await a?.queryFn({apiClient:i,apiUrl:u,variables:y,url:c}):await i({url:`${c}${y.id}${r?"/":""}`,method:"GET",params:n,...s})}})};import{useMutation as Pe,useQueryClient as De}from"@tanstack/react-query";import{useRef as Qe}from"react";var _=({queryClient:e,data:t,queryKeysOne:a,queryKeysList:n,queryKeysInfiniteList:s,cacheAddItemTo:u="start"})=>{let i=r=>!r||!(r.data instanceof Array)?r:{...r,data:u==="start"?[t,...r.data]:[...r.data,t]};a&&a.forEach(r=>{e.setQueryData(r,t)}),n&&n.forEach(r=>{e.setQueriesData({queryKey:r},i)}),s&&s.forEach(r=>{e.setQueriesData({queryKey:r},o=>o&&{...o,pages:o.pages.map(i)})})};var J=({queryClient:e,ids:t,queryKeysOne:a,queryKeysList:n,queryKeysInfiniteList:s})=>{let u=i=>!i||!(i.data instanceof Array)?i:{...i,data:i.data.filter(r=>!t.some(o=>String(o)===String(r.id)))};a&&a.forEach(i=>{e.removeQueries({queryKey:i})}),n&&n.forEach(i=>{e.setQueriesData({queryKey:i},u)}),s&&s.forEach(i=>{e.setQueriesData({queryKey:i},r=>r&&{...r,pages:r.pages.map(u)})})};var f={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(a=>["get-one",e.path,e.params,String(a)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params],getDataQuery:e=>["query-data",e.path,e.params]};function w(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){let a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(let s of a){let u=e[s],i=t[s];if(u!==i&&!w(u,i))return!1}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a]&&!w(e[a],t[a]))return!1;return!0}return e===t}var Kt=({queryClient:e,queryKeys:t})=>{e.invalidateQueries({predicate:a=>{let n=a.queryKey;return t.some(s=>s.every(u=>n.some(i=>w(i,u))))}})};var L=({queryClient:e,queryKeys:t})=>{t.forEach(a=>{e.invalidateQueries({queryKey:a})})};function $(e,t){let a={...e};if(e instanceof Object&&t instanceof Object){for(let n in t)if(n in e){let s=e[n],u=t[n];typeof s==typeof u&&(Array.isArray(s)&&Array.isArray(u)||s!==null&&!Array.isArray(s)&&typeof s=="object"&&!Array.isArray(u)&&typeof u=="object"||typeof s!="object"&&typeof u!="object")&&(typeof s=="object"&&s!==null&&!Array.isArray(s)?a[n]=$(s,u):a[n]=u)}}return a}var Y=({queryClient:e,data:t,ids:a,queryKeysOne:n,queryKeysList:s,queryKeysInfiniteList:u})=>{let i=r=>!r||!(r.data instanceof Array)?r:{...r,data:r.data.map(o=>a.some(m=>String(m)===String(o.id))?$(o,t):o)};n&&n.forEach(r=>{e.setQueriesData({queryKey:r},o=>!o||!(o.data instanceof Object)||!(t instanceof Object)?o:{...o,data:$(o.data,t)})}),s&&s.forEach(r=>{e.setQueriesData({queryKey:r},i)}),u&&u.forEach(r=>{e.setQueriesData({queryKey:r},o=>o&&{...o,pages:o.pages.map(i)})})};var j=async(e,t)=>{let a=t.reduce((n,s)=>n.concat(e.getQueriesData({queryKey:s})),[]);return await Promise.all(a.map(([n])=>e.cancelQueries({queryKey:n}))),a};var X=({resourcePath:e,mutationOptions:t,mode:a={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:s=!0,isInvalidateCache:u=!0,type:i="many"})=>{let{apiUrl:r,apiClient:o,apiEnsureTrailingSlash:m,toastUndo:y}=C(),c=De(),Q=Qe([]),P=()=>{Q.current.forEach(([p,d])=>{c.setQueryData(p,d)})},{mutate:E,...R}=Pe({...t,mutationKey:[i==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async p=>{let d=`${r}/${g(p.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:o,apiUrl:r,variables:p,url:d});let l=i==="many"?p.ids:[p.id],T=await Promise.allSettled(l.map(D=>o({url:`${d}${D}${m?"/":""}`,method:"DELETE",...p.apiClientParams}))),h=[];return T.forEach(D=>{if(D.status==="fulfilled")h.push(D.value);else throw D.reason}),i==="many"?h:h[0]},onSuccess:(...p)=>{let d=p[1],l=[f.getList(d.resource),f.getInfiniteList(d.resource)];n.forEach(T=>{l.push(f.getList(T)),l.push(f.getInfiniteList(T))}),u&&L({queryClient:c,queryKeys:l}),t?.onSuccess&&t.onSuccess(...p)},onError:(...p)=>{t?.onError&&t.onError(...p),P()}});return{mutation:R,delete:async({resourceParams:p,undoMessage:d,...l})=>{let T={path:e,params:p},h=i==="many"?l.ids:[l.id];if(a.optimistic){let D=s?f.getOneArray(T,h):[],K=s?[f.getList(T)]:[],F=s?[f.getInfiniteList(T)]:[];n.forEach(v=>{D.push(...f.getOneArray(v,h)),K.push(f.getList(v)),F.push(f.getInfiniteList(v))}),Q.current=await j(c,[...D,...K,...F]),J({queryClient:c,ids:h,queryKeysOne:D,queryKeysList:K,queryKeysInfiniteList:F})}if(a.undoable){let D=h.length>1;M.once("end",K=>{K?P():E({...l,resource:T})}),y({message:d||`Element${D?"s":""} deleted`,type:D?"delete-many":"delete-one"})}else E({...l,resource:T})}}},Gt=e=>X({...e,type:"one"}),Ht=e=>X({...e,type:"many"});import{useMutation as xe,useQueryClient as Ee}from"@tanstack/react-query";import{useRef as ge}from"react";var Z=({resourcePath:e,mutationOptions:t,mode:a={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:s=!0,type:u="many"})=>{let{apiUrl:i,apiClient:r,apiEnsureTrailingSlash:o,toastUndo:m}=C(),y=Ee(),c=ge([]),Q=()=>{c.current.forEach(([x,p])=>{y.setQueryData(x,p)})},{mutate:P,...E}=xe({...t,mutationKey:[u==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async x=>{let p=`${i}/${g(x.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:r,apiUrl:i,variables:x,url:p});let d=u==="many"?x.ids:[x.id],l=await Promise.allSettled(d.map(h=>r({url:`${p}${h}${o?"/":""}`,method:"PATCH",data:x.data,...x.apiClientParams}))),T=[];return l.forEach(h=>{if(h.status==="fulfilled")T.push(h.value);else throw h.reason}),u==="many"?T:T[0]},onSuccess:(...x)=>{let p=x[1];if(!a.optimistic){let d=u==="many"?p.ids:[p.id],l=[...f.getOneArray(p.resource,d),f.getList(p.resource),f.getInfiniteList(p.resource)];n.forEach(T=>{l.push(...f.getOneArray(T,d)),l.push(f.getList(T)),l.push(f.getInfiniteList(T))}),L({queryClient:y,queryKeys:l})}t?.onSuccess&&t.onSuccess(...x)},onError:(...x)=>{t?.onError&&t.onError(...x),Q()}});return{mutation:E,update:async({resourceParams:x,undoMessage:p,...d})=>{let l={path:e,params:x},T=u==="many"?d.ids:[d.id];if(a.optimistic){let h=s?f.getOneArray(l,T):[],D=s?[f.getList(l)]:[],K=s?[f.getInfiniteList(l)]:[];n.forEach(F=>{h.push(...f.getOneArray(F,T)),D.push(f.getList(F)),K.push(f.getInfiniteList(F))}),c.current=await j(y,[...h,...D,...K]),Y({queryClient:y,data:d.data,ids:T,queryKeysOne:h,queryKeysList:D,queryKeysInfiniteList:K})}if(a.undoable){let h=T.length>1;M.once("end",D=>{D?Q():P({...d,resource:l})}),m({message:p||`Element${h?"s":""} updated`,type:h?"update-many":"update-one"})}else P({...d,resource:l})}}},ra=e=>Z({...e,type:"one"}),sa=e=>Z({...e,type:"many"});import{useMutation as Ce,useQueryClient as Re}from"@tanstack/react-query";var pa=({resourcePath:e,mutationOptions:t,extraResources:a=[],shouldUpdateCurrentResource:n=!0,cacheAddItemTo:s="start",isInvalidateCache:u=!0})=>{let{apiUrl:i,apiClient:r,apiEnsureTrailingSlash:o}=C(),m=Re(),{mutate:y,...c}=Ce({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async P=>{let E=`${i}/${g(P.resource,o)}`;return t?.mutationFn?await t?.mutationFn({apiClient:r,apiUrl:i,variables:P,url:E}):await r({url:E,method:"POST",data:P.data,...P.apiClientParams})},onSuccess:(...P)=>{let E=P[0];if(E){let R=P[1],{id:x}=E.data,p=n?[f.getOne(R.resource,x)]:[],d=n?[f.getList(R.resource)]:[],l=n?[f.getInfiniteList(R.resource)]:[];a.forEach(T=>{p.push(f.getOne(T,x)),d.push(f.getList(T)),l.push(f.getInfiniteList(T))}),_({queryClient:m,data:E.data||{},queryKeysOne:p.map(T=>[...T,{}]),queryKeysList:d,queryKeysInfiniteList:l,cacheAddItemTo:s}),u&&L({queryClient:m,queryKeys:[...d,...l]})}t?.onSuccess&&t.onSuccess(...P)}});return{mutation:c,create:({resourceParams:P,...E})=>{y({...E,resource:{path:e,params:P}})}}};import{useQuery as Ke}from"@tanstack/react-query";var fa=({queryOptions:e,resource:t,params:a={},apiClientParams:n})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:i}=C();return Ke({...e,queryKey:["query-data",t.path,t.params,a,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:o})=>{let m={resource:t,params:a,queryKey:o},y=`${s}/${g(m.resource,i)}`;return e?.queryFn?await e?.queryFn({apiClient:u,apiUrl:s,variables:m,url:y}):await u({url:y,method:"GET",params:a,...n})}})};import{useMutation as be}from"@tanstack/react-query";var Qa=({resourcePath:e,mutationOptions:t})=>{let{apiUrl:a,apiClient:n,apiEnsureTrailingSlash:s}=C(),{mutate:u,...i}=be({...t,mutationKey:["mutate-data",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async o=>{let m=`${a}/${g(o.resource,s)}`;return t?.mutationFn?await t?.mutationFn({apiClient:n,apiUrl:a,variables:o,url:m}):await n({url:m,data:o.data,...o.apiClientParams})}});return{mutation:i,mutate:async({resourceParams:o,...m})=>{u({...m,resource:{path:e,params:o}})}}};export{S as CustomError,rt as RQWrapper,Ve as ToastBar,_ as addItemFromQueryCache,J as deleteItemsFromQueryCache,B as fetcher,g as getUrlFromResource,f as helpersQueryKeys,Kt as invalidateMatchingQueries,L as invalidateQueries,ke as resolveToastValue,q as toast,Y as updateItemsFromQueryCache,pa as useCreate,Qa as useDataMutate,fa as useDataQuery,Ht as useDeleteMany,Gt as useDeleteOne,Tt as useGetInfiniteList,ut as useGetList,Dt as useGetOne,C as useRQWrapperContext,sa as useUpdateMany,ra as useUpdateOne};
//# sourceMappingURL=index.mjs.map