export*from"@tanstack/react-query";import{useQuery as Te}from"@tanstack/react-query";function A(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var R=(e,t)=>{let r=A(e.path.replace(/{(\w+)}/g,(n,s)=>e.params[s].toString()));return t?`${r}/`:r};import{QueryClient as pe,QueryClientProvider as ce}from"@tanstack/react-query";import{ReactQueryDevtools as me}from"@tanstack/react-query-devtools";import M,{createContext as le,useCallback as N,useContext as fe,useMemo as G}from"react";var S=class e extends Error{constructor(r,n,s){super(r);this.message=r;this.status=n;this.data=s;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(r).stack,this.stack=new Error().stack,console.error(this.message,this)}};var ee=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([n,s])=>{(s||typeof s=="boolean"||typeof s=="number")&&(t[n]=s)}),t}return{}};function U(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:r}=e,n=e.data instanceof FormData,s=(()=>{let a=e.url;if(e.params){let y=ee(e.params);if(e.queryParamsSerializer)a+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(y).length>0){let p=[];for(let D in y)y.hasOwnProperty(D)&&(Array.isArray(y[D])?y[D].forEach(Q=>{p.push(`${U(D)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${U(Q)}`)}):p.push(`${U(D)}=${U(y[D])}`));a+=`?${p.join("&")}`}}let[o,c]=a.split("?");return`${o}${c?`?${c}`:""}`})(),u=n?e.data:e.data?JSON.stringify(e.data):"",i={method:e.method,headers:{...!n&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...u&&{body:u},...e.options};return fetch(s,i).then(async a=>{let o=await(async()=>{try{let y=a.headers.get("Content-Type")?.toLowerCase()||"";return y.includes("application/json")?await a.json():y.includes("text/plain")||y.includes("text/csv")||y.includes("application/xml")||y.includes("text/xml")||y.includes("application/javascript")||y.includes("text/html")?await a.text():y.includes("multipart/form-data")?await a.formData():await a.blob()}catch(y){throw console.error("Error handling response:",y),y}})(),c={};return a.headers.forEach((y,p)=>{c[p]=y}),{status:a.status,statusText:a.statusText,headers:c,data:o}}).then(a=>{if(a.status<200||a.status>=300){let o=new S(`Request failed with status code: ${a.status}`,a.status,a.data);return r&&r(o,e),Promise.reject(o)}return t&&t(a,e),Promise.resolve(a)}).catch(a=>Promise.reject(new S(a.message)))};import I,{useCallback as te}from"react";import{resolveValue as V,useToaster as re}from"react-hot-toast/headless";var ae=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function se({id:e,className:t,style:r,onHeightUpdate:n,children:s}){let u=te(i=>{if(i){let a=()=>{let{height:o}=i.getBoundingClientRect();n(e,o)};a(),new MutationObserver(a).observe(i,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return I.createElement("div",{ref:u,className:t,style:r},s)}var ne=(e,t)=>{let r=e.includes("top"),n=r?{top:0}:{bottom:0},s=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ae()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...n,...s}},O=16;function k({reverseOrder:e,position:t="top-center",toastOptions:r,gutter:n,children:s,containerStyle:u,containerClassName:i}){let{toasts:a,handlers:o}=re(r);return I.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...u},className:i,onMouseEnter:o.startPause,onMouseLeave:o.endPause},a.map(c=>{let y=c.position||t,p={...c,position:y},D=o.calculateOffset(p,{reverseOrder:e,gutter:n,defaultPosition:t}),Q=ne(y,D);return I.createElement(se,{id:p.id,key:p.id,onHeightUpdate:o.updateHeight,style:{...Q,pointerEvents:"auto"}},p.type==="custom"?V(c.message,p):s?s(p):I.createElement("div",{style:{display:c.visible?"flex":"none"}},V(p.message,p)))}))}import W from"react-hot-toast/headless";import{ToastBar as oe,resolveValue as ie}from"react-hot-toast";var{remove:Be,...ue}=W,q=Object.assign((...e)=>W(...e),ue),Ve=oe,ke=ie;import ye from"eventemitter3";var z=new ye,F={once:(e,t)=>{z.once(e,t)},emit:(e,t)=>{z.emit(e,t)}};var H=le({apiUrl:"",apiEnsureTrailingSlash:!1,apiClient:B,toastUndo:()=>{}}),x=()=>fe(H);function at({children:e,config:t={},apiUrl:r,apiClient:n=B,apiEnsureTrailingSlash:s=!1,apiAuthorization:u,apiHeaders:i,apiOnSuccess:a,apiOnError:o,isDevTools:c,devToolsOptions:y,toast:p}){let D=G(()=>new pe({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}}),[]),Q=N(l=>{let m=u?u():"",h=i?i():{},T=(...P)=>{a&&a(...P),l.onSuccess&&l.onSuccess(...P)},f=(...P)=>{o&&o(...P),l.onError&&l.onError(...P)};return n({...l,headers:l.headers?{...h,...l.headers}:h,authorization:l.authorization||m,onSuccess:T,onError:f})},[]),C=N(l=>{let m=!1;q.dismiss();let h=()=>{m=!0,F.emit("end",!0),q.dismiss()},T=p?.customUndoContent?p?.customUndoContent({message:l.message,onUndo:h,type:l.type}):null;q.success(f=>(!f.visible&&!m&&(m=!0,F.emit("end",!1)),T||M.createElement(M.Fragment,null,l.message,M.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:h,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:p?.globalProps?.toastOptions?.duration||5e3})},[]),K=G(()=>({apiUrl:A(r),apiClient:Q,apiEnsureTrailingSlash:s,toastUndo:C}),[r,Q,C,s]);return M.createElement(ce,{client:D},M.createElement(k,{...p?.globalProps},p?.wrapper),M.createElement(H.Provider,{value:K},e),c&&M.createElement(me,{buttonPosition:"bottom-right",initialIsOpen:!1,...y}))}var ut=({queryOptions:e,resource:t,params:r={},apiClientParams:n})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:i}=x();return Te({...e,queryKey:["get-list",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:o})=>{let c={resource:t,params:r,queryKey:o},y=`${s}/${R(c.resource,i)}`;return e?.queryFn?await e?.queryFn({apiClient:u,apiUrl:s,variables:c,url:y}):await u({url:y,method:"GET",params:r,...n})}})};import{useInfiniteQuery as de}from"@tanstack/react-query";var ft=({queryOptions:e,resource:t,params:r={},apiClientParams:n,pagination:s})=>{let{apiUrl:u,apiClient:i,apiEnsureTrailingSlash:a}=x();return de({initialPageParam:1,getNextPageParam:(...c)=>{let y=c[0],p=Number(c[2]);if(y?.data?.length)return p+1},getPreviousPageParam:(...c)=>{let y=Number(c[2]);if(!(y<=1))return y-1},...e,queryKey:["get-infinite-list",t.path,t.params,s,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:c,pageParam:y})=>{let p={resource:t,params:{...r,[s.page[0]]:y,[s.per_page[0]]:s.per_page[1]},queryKey:c},D=`${u}/${R(p.resource,a)}`;return e?.queryFn?await e?.queryFn({apiClient:i,apiUrl:u,variables:p,url:D}):await i({url:D,method:"GET",params:p.params,...n})}})};import{useQuery as he}from"@tanstack/react-query";var Qt=({resource:e,id:t,queryOptions:r,params:n={},apiClientParams:s})=>{let{apiUrl:u,apiClient:i,apiEnsureTrailingSlash:a}=x();return he({...r,queryKey:["get-one",e.path,e.params,String(t),n,...r?.queryKey?r.queryKey:[]],queryFn:async({queryKey:c})=>{let y={id:t,resource:e,params:n,queryKey:c},p=`${u}/${R(y.resource,!0)}`;return r?.queryFn?await r?.queryFn({apiClient:i,apiUrl:u,variables:y,url:p}):await i({url:`${p}${y.id}${a?"/":""}`,method:"GET",params:n,...s})}})};import{useMutation as Pe,useQueryClient as Qe}from"@tanstack/react-query";import{useRef as De}from"react";var _=({queryClient:e,data:t,queryKeysOne:r,queryKeysList:n,queryKeysInfiniteList:s,cacheAddItemTo:u="start"})=>{let i=a=>!a||!(a.data instanceof Array)?a:{...a,data:u==="start"?[t,...a.data]:[...a.data,t]};r&&r.forEach(a=>{e.setQueryData(a,t)}),n&&n.forEach(a=>{e.setQueriesData({queryKey:a},i)}),s&&s.forEach(a=>{e.setQueriesData({queryKey:a},o=>o&&{...o,pages:o.pages.map(i)})})};var J=({queryClient:e,ids:t,queryKeysOne:r,queryKeysList:n,queryKeysInfiniteList:s})=>{let u=i=>!i||!(i.data instanceof Array)?i:{...i,data:i.data.filter(a=>!t.some(o=>String(o)===String(a.id)))};r&&r.forEach(i=>{e.removeQueries({queryKey:i})}),n&&n.forEach(i=>{e.setQueriesData({queryKey:i},u)}),s&&s.forEach(i=>{e.setQueriesData({queryKey:i},a=>a&&{...a,pages:a.pages.map(u)})})};var d={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(r=>["get-one",e.path,e.params,String(r)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params],getDataQuery:e=>["query-data",e.path,e.params]};function w(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let s of r){let u=e[s],i=t[s];if(u!==i&&!w(u,i))return!1}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]&&!w(e[r],t[r]))return!1;return!0}return e===t}var bt=({queryClient:e,queryKeys:t})=>{e.invalidateQueries({predicate:r=>{let n=r.queryKey;return t.some(s=>s.every(u=>n.some(i=>w(i,u))))}})};var L=({queryClient:e,queryKeys:t})=>{t.forEach(r=>{e.invalidateQueries({queryKey:r})})};function $(e,t){let r={...e};if(e instanceof Object&&t instanceof Object){for(let n in t)if(n in e){let s=e[n],u=t[n];typeof s==typeof u&&(Array.isArray(s)&&Array.isArray(u)||s!==null&&!Array.isArray(s)&&typeof s=="object"&&!Array.isArray(u)&&typeof u=="object"||typeof s!="object"&&typeof u!="object")&&(typeof s=="object"&&s!==null&&!Array.isArray(s)?r[n]=$(s,u):r[n]=u)}}return r}var Y=({queryClient:e,data:t,ids:r,queryKeysOne:n,queryKeysList:s,queryKeysInfiniteList:u})=>{let i=a=>!a||!(a.data instanceof Array)?a:{...a,data:a.data.map(o=>r.some(c=>String(c)===String(o.id))?$(o,t):o)};n&&n.forEach(a=>{e.setQueriesData({queryKey:a},o=>!o||!(o.data instanceof Object)||!(t instanceof Object)?o:{...o,data:$(o.data,t)})}),s&&s.forEach(a=>{e.setQueriesData({queryKey:a},i)}),u&&u.forEach(a=>{e.setQueriesData({queryKey:a},o=>o&&{...o,pages:o.pages.map(i)})})};var j=async(e,t)=>{let r=t.reduce((n,s)=>n.concat(e.getQueriesData({queryKey:s})),[]);return await Promise.all(r.map(([n])=>e.cancelQueries({queryKey:n}))),r};var X=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:s=!0,isInvalidateCache:u=!0,type:i="many"})=>{let{apiUrl:a,apiClient:o,apiEnsureTrailingSlash:c,toastUndo:y}=x(),p=Qe(),D=De([]),Q=()=>{D.current.forEach(([m,h])=>{p.setQueryData(m,h)})},{mutate:C,...K}=Pe({...t,mutationKey:[i==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let h=`${a}/${R(m.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:o,apiUrl:a,variables:m,url:h});let T=i==="many"?m.ids:[m.id],f=await Promise.allSettled(T.map(g=>o({url:`${h}${g}${c?"/":""}`,method:"DELETE",...m.apiClientParams}))),P=[];return f.forEach(g=>{if(g.status==="fulfilled")P.push(g.value);else throw g.reason}),i==="many"?P:P[0]},onSuccess:(...m)=>{let h=m[1],T=[d.getList(h.resource),d.getInfiniteList(h.resource)];n.forEach(f=>{T.push(d.getList(f)),T.push(d.getInfiniteList(f))}),u&&L({queryClient:p,queryKeys:T}),t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),Q()}});return{mutation:K,delete:async({resourceParams:m,undoMessage:h,...T})=>{let f={path:e,params:m},P=i==="many"?T.ids:[T.id];if(r.optimistic){let g=s?d.getOneArray(f,P):[],b=s?[d.getList(f)]:[],E=s?[d.getInfiniteList(f)]:[];n.forEach(v=>{g.push(...d.getOneArray(v,P)),b.push(d.getList(v)),E.push(d.getInfiniteList(v))}),D.current=await j(p,[...g,...b,...E]),J({queryClient:p,ids:P,queryKeysOne:g,queryKeysList:b,queryKeysInfiniteList:E})}if(r.undoable){let g=P.length>1;F.once("end",b=>{b?Q():C({...T,resource:f})}),y({message:h||`Element${g?"s":""} deleted`,type:g?"delete-many":"delete-one"})}else C({...T,resource:f})}}},Gt=e=>X({...e,type:"one"}),Ht=e=>X({...e,type:"many"});import{useMutation as ge,useQueryClient as Ce}from"@tanstack/react-query";import{useRef as Re}from"react";var Z=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:s=!0,type:u="many"})=>{let{apiUrl:i,apiClient:a,apiEnsureTrailingSlash:o,toastUndo:c}=x(),y=Ce(),p=Re([]),D=()=>{p.current.forEach(([l,m])=>{y.setQueryData(l,m)})},{mutate:Q,...C}=ge({...t,mutationKey:[u==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async l=>{let m=`${i}/${R(l.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:a,apiUrl:i,variables:l,url:m});let h=u==="many"?l.ids:[l.id],T=await Promise.allSettled(h.map(P=>a({url:`${m}${P}${o?"/":""}`,method:"PATCH",data:l.data,...l.apiClientParams}))),f=[];return T.forEach(P=>{if(P.status==="fulfilled")f.push(P.value);else throw P.reason}),u==="many"?f:f[0]},onSuccess:(...l)=>{let m=l[1];if(!r.optimistic){let h=u==="many"?m.ids:[m.id],T=[...d.getOneArray(m.resource,h),d.getList(m.resource),d.getInfiniteList(m.resource)];n.forEach(f=>{T.push(...d.getOneArray(f,h)),T.push(d.getList(f)),T.push(d.getInfiniteList(f))}),L({queryClient:y,queryKeys:T})}t?.onSuccess&&t.onSuccess(...l)},onError:(...l)=>{t?.onError&&t.onError(...l),D()}});return{mutation:C,update:async({resourceParams:l,undoMessage:m,...h})=>{let T={path:e,params:l},f=u==="many"?h.ids:[h.id];if(r.optimistic){let P=s?d.getOneArray(T,f):[],g=s?[d.getList(T)]:[],b=s?[d.getInfiniteList(T)]:[];n.forEach(E=>{P.push(...d.getOneArray(E,f)),g.push(d.getList(E)),b.push(d.getInfiniteList(E))}),p.current=await j(y,[...P,...g,...b]),Y({queryClient:y,data:h.data,ids:f,queryKeysOne:P,queryKeysList:g,queryKeysInfiniteList:b})}if(r.undoable){let P=f.length>1;F.once("end",g=>{g?D():Q({...h,resource:T})}),c({message:m||`Element${P?"s":""} updated`,type:P?"update-many":"update-one"})}else Q({...h,resource:T})}}},ar=e=>Z({...e,type:"one"}),sr=e=>Z({...e,type:"many"});import{useMutation as xe,useQueryClient as Ke}from"@tanstack/react-query";var pr=({resourcePath:e,mutationOptions:t,extraResources:r=[],shouldUpdateCurrentResource:n=!0,cacheAddItemTo:s="start",isInvalidateCache:u=!0})=>{let{apiUrl:i,apiClient:a,apiEnsureTrailingSlash:o}=x(),c=Ke(),{mutate:y,...p}=xe({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async Q=>{let C=`${i}/${R(Q.resource,o)}`;return t?.mutationFn?await t?.mutationFn({apiClient:a,apiUrl:i,variables:Q,url:C}):await a({url:C,method:"POST",data:Q.data,...Q.apiClientParams})},onSuccess:(...Q)=>{let C=Q[0];if(C){let K=Q[1],{id:l}=C.data,m=n?[d.getOne(K.resource,l)]:[],h=n?[d.getList(K.resource)]:[],T=n?[d.getInfiniteList(K.resource)]:[];r.forEach(f=>{m.push(d.getOne(f,l)),h.push(d.getList(f)),T.push(d.getInfiniteList(f))}),_({queryClient:c,data:C.data||{},queryKeysOne:m.map(f=>[...f,{}]),queryKeysList:h,queryKeysInfiniteList:T,cacheAddItemTo:s}),u&&L({queryClient:c,queryKeys:[...h,...T]})}t?.onSuccess&&t.onSuccess(...Q)}});return{mutation:p,create:({resourceParams:Q,...C})=>{y({...C,resource:{path:e,params:Q}})}}};import{useQuery as be}from"@tanstack/react-query";var Tr=({queryOptions:e,resource:t,params:r={},apiClientParams:n})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:i}=x();return be({...e,queryKey:["query-data",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:o})=>{let c={resource:t,params:r,queryKey:o},y=`${s}/${R(c.resource,i)}`;return e?.queryFn?await e?.queryFn({apiClient:u,apiUrl:s,variables:c,url:y}):await u({url:y,method:"GET",params:r,...n})}})};import{useMutation as Ee}from"@tanstack/react-query";var Dr=({resourcePath:e,mutationOptions:t})=>{let{apiUrl:r,apiClient:n,apiEnsureTrailingSlash:s}=x(),{mutate:u,...i}=Ee({...t,mutationKey:["mutate-data",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async o=>{let c=`${r}/${R(o.resource,s)}`;return t?.mutationFn?await t?.mutationFn({apiClient:n,apiUrl:r,variables:o,url:c}):await n({url:c,data:o.data,...o.apiClientParams})}});return{mutation:i,mutate:async({resourceParams:o,...c})=>{u({...c,resource:{path:e,params:o}})}}};export{S as CustomError,at as RQWrapper,Ve as ToastBar,_ as addItemFromQueryCache,J as deleteItemsFromQueryCache,B as fetcher,R as getUrlFromResource,d as helpersQueryKeys,bt as invalidateMatchingQueries,L as invalidateQueries,ke as resolveToastValue,q as toast,Y as updateItemsFromQueryCache,pr as useCreate,Dr as useDataMutate,Tr as useDataQuery,Ht as useDeleteMany,Gt as useDeleteOne,ft as useGetInfiniteList,ut as useGetList,Qt as useGetOne,x as useRQWrapperContext,sr as useUpdateMany,ar as useUpdateOne};
//# sourceMappingURL=index.mjs.map