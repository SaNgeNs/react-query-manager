export*from"@tanstack/react-query";import{useQuery as de}from"@tanstack/react-query";function U(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var g=(e,t)=>{let a=U(e.path.replace(/{(\w+)}/g,(n,s)=>e.params[s].toString()));return t?`${a}/`:a};import{QueryClient as ce,QueryClientProvider as me}from"@tanstack/react-query";import{ReactQueryDevtools as le}from"@tanstack/react-query-devtools";import K,{createContext as Te,useCallback as N,useContext as fe,useMemo as G}from"react";var A=class e extends Error{constructor(a,n,s){super(a);this.message=a;this.status=n;this.data=s;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(a).stack,this.stack=new Error().stack,console.error(this.message,this)}};var ee=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([n,s])=>{(s||typeof s=="boolean"||typeof s=="number")&&(t[n]=s)}),t}return{}};function O(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:a}=e,n=e.data instanceof FormData,s=(()=>{let r=e.url;if(e.params){let i=ee(e.params);if(e.queryParamsSerializer)r+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(i).length>0){let c=[];for(let Q in i)i.hasOwnProperty(Q)&&(Array.isArray(i[Q])?i[Q].forEach(D=>{c.push(`${O(Q)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${O(D)}`)}):c.push(`${O(Q)}=${O(i[Q])}`));r+=`?${c.join("&")}`}}let[o,p]=r.split("?");return`${o}${p?`?${p}`:""}`})(),u=n?e.data:e.data?JSON.stringify(e.data):"",y={method:e.method,headers:{...!n&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...u&&{body:u},...e.options};return fetch(s,y).then(async r=>{let o=await(async()=>{try{let i=r.headers.get("Content-Type")?.toLowerCase()||"";return i.includes("application/json")?await r.json():i.includes("text/plain")||i.includes("text/csv")||i.includes("application/xml")||i.includes("text/xml")||i.includes("application/javascript")||i.includes("text/html")?await r.text():i.includes("multipart/form-data")?await r.formData():await r.blob()}catch(i){throw console.error("Error handling response:",i),i}})(),p={};return r.headers.forEach((i,c)=>{p[c]=i}),{status:r.status,statusText:r.statusText,headers:p,data:o}}).then(r=>{if(r.status<200||r.status>=300){let o=new A(`Request failed with status code: ${r.status}`,r.status,r.data);return a&&a(o,e),Promise.reject(o)}return t&&t(r,e),Promise.resolve(r)}).catch(r=>Promise.reject(new A(r.message)))};import q,{useCallback as se,useEffect as oe}from"react";import{resolveValue as k,useToaster as ne}from"react-hot-toast/headless";import V from"react-hot-toast/headless";import{ToastBar as te,resolveValue as ae}from"react-hot-toast";var{remove:$e,...re}=V,L=Object.assign((...e)=>V(...e),re),je=te,Be=ae;var ie=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function ue({id:e,visible:t,closeOutside:a,className:n,style:s,onHeightUpdate:u,children:y}){let r=se(o=>{if(o){let p=()=>{let{height:i}=o.getBoundingClientRect();u(e,i)};p(),new MutationObserver(p).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[e,u]);return oe(()=>{let o=p=>{p.target.closest(`[data-toast-id="${e}"]`)||L.dismiss(e)};return a&&setTimeout(()=>{document.addEventListener("click",o)},0),()=>{a&&setTimeout(()=>{document.removeEventListener("click",o)},0)}},[t,e,a]),q.createElement("div",{"data-toast-id":e,ref:r,className:n,style:s},y)}var ye=(e,t)=>{let a=e.includes("top"),n=a?{top:0}:{bottom:0},s=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ie()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(a?1:-1)}px)`,...n,...s}},I=16;function W({reverseOrder:e,position:t="top-center",toastOptions:a,gutter:n,children:s,containerStyle:u,containerClassName:y}){let{toasts:r,handlers:o}=ne(a);return q.createElement("div",{style:{position:"fixed",zIndex:9999,top:I,left:I,right:I,bottom:I,pointerEvents:"none",...u},className:y,onMouseEnter:o.startPause,onMouseLeave:o.endPause},r.map(p=>{let i=p.position||t,c={...p,position:i},Q=o.calculateOffset(c,{reverseOrder:e,gutter:n,defaultPosition:t}),D=ye(i,Q);return q.createElement(ue,{id:c.id,key:c.id,visible:c.visible,closeOutside:c?.extraParams?.closeOutside||!1,onHeightUpdate:o.updateHeight,style:{...D,pointerEvents:"auto"}},c.type==="custom"?k(p.message,c):s?s(c):q.createElement("div",{style:{display:p.visible?"flex":"none"}},k(c.message,c)))}))}import pe from"eventemitter3";var z=new pe,M={once:(e,t)=>{z.once(e,t)},emit:(e,t)=>{z.emit(e,t)}};var H=Te({apiUrl:"",apiEnsureTrailingSlash:!1,apiClient:B,toastUndo:()=>{}}),b=()=>fe(H);function ot({children:e,config:t={},apiUrl:a,apiClient:n=B,apiEnsureTrailingSlash:s=!1,apiAuthorization:u,apiHeaders:y,apiOnSuccess:r,apiOnError:o,isDevTools:p,devToolsOptions:i,toast:c}){let Q=G(()=>new ce({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}}),[]),D=N(l=>{let m=u?u():"",h=y?y():{},f=(...P)=>{r&&r(...P),l.onSuccess&&l.onSuccess(...P)},T=(...P)=>{o&&o(...P),l.onError&&l.onError(...P)};return n({...l,headers:l.headers?{...h,...l.headers}:h,authorization:l.authorization||m,onSuccess:f,onError:T})},[]),E=N(l=>{let m=!1;L.dismiss();let h=()=>{m=!0,M.emit("end",!0),L.dismiss()},f=c?.customUndoContent;L.success(T=>(!T.visible&&!m&&(m=!0,M.emit("end",!1)),f?K.createElement(f,{message:l.message,onUndo:h,type:l.type}):K.createElement(K.Fragment,null,l.message,K.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:h,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:c?.globalProps?.toastOptions?.duration||5e3,extraParams:{closeOutside:!0}})},[]),C=G(()=>({apiUrl:U(a),apiClient:D,apiEnsureTrailingSlash:s,toastUndo:E}),[a,D,E,s]);return K.createElement(me,{client:Q},K.createElement(W,{...c?.globalProps},c?.wrapper),K.createElement(H.Provider,{value:C},e),p&&K.createElement(le,{buttonPosition:"bottom-right",initialIsOpen:!1,...i}))}var pt=({queryOptions:e,resource:t,params:a={},apiClientParams:n})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:y}=b();return de({...e,queryKey:["get-list",t.path,t.params,a,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:o})=>{let p={resource:t,params:a,queryKey:o},i=`${s}/${g(p.resource,y)}`;return e?.queryFn?await e?.queryFn({apiClient:u,apiUrl:s,variables:p,url:i}):await u({url:i,method:"GET",params:a,...n})}})};import{useInfiniteQuery as he}from"@tanstack/react-query";var dt=({queryOptions:e,resource:t,params:a={},apiClientParams:n,pagination:s})=>{let{apiUrl:u,apiClient:y,apiEnsureTrailingSlash:r}=b();return he({initialPageParam:1,getNextPageParam:(...p)=>{let i=p[0],c=Number(p[2]);if(i?.data?.length)return c+1},getPreviousPageParam:(...p)=>{let i=Number(p[2]);if(!(i<=1))return i-1},...e,queryKey:["get-infinite-list",t.path,t.params,s,a,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:p,pageParam:i})=>{let c={resource:t,params:{...a,[s.page[0]]:i,[s.per_page[0]]:s.per_page[1]},queryKey:p},Q=`${u}/${g(c.resource,r)}`;return e?.queryFn?await e?.queryFn({apiClient:y,apiUrl:u,variables:c,url:Q}):await y({url:Q,method:"GET",params:c.params,...n})}})};import{useQuery as Pe}from"@tanstack/react-query";var xt=({resource:e,id:t,queryOptions:a,params:n={},apiClientParams:s})=>{let{apiUrl:u,apiClient:y,apiEnsureTrailingSlash:r}=b();return Pe({...a,queryKey:["get-one",e.path,e.params,String(t),n,...a?.queryKey?a.queryKey:[]],queryFn:async({queryKey:p})=>{let i={id:t,resource:e,params:n,queryKey:p},c=`${u}/${g(i.resource,!0)}`;return a?.queryFn?await a?.queryFn({apiClient:y,apiUrl:u,variables:i,url:c}):await y({url:`${c}${i.id}${r?"/":""}`,method:"GET",params:n,...s})}})};import{useMutation as De,useQueryClient as Qe}from"@tanstack/react-query";import{useRef as xe}from"react";var _=({queryClient:e,data:t,queryKeysOne:a,queryKeysList:n,queryKeysInfiniteList:s,cacheAddItemTo:u="start"})=>{let y=r=>!r||!(r.data instanceof Array)?r:{...r,data:u==="start"?[t,...r.data]:[...r.data,t]};a&&a.forEach(r=>{e.setQueryData(r,t)}),n&&n.forEach(r=>{e.setQueriesData({queryKey:r},y)}),s&&s.forEach(r=>{e.setQueriesData({queryKey:r},o=>o&&{...o,pages:o.pages.map(y)})})};var J=({queryClient:e,ids:t,queryKeysOne:a,queryKeysList:n,queryKeysInfiniteList:s})=>{let u=y=>!y||!(y.data instanceof Array)?y:{...y,data:y.data.filter(r=>!t.some(o=>String(o)===String(r.id)))};a&&a.forEach(y=>{e.removeQueries({queryKey:y})}),n&&n.forEach(y=>{e.setQueriesData({queryKey:y},u)}),s&&s.forEach(y=>{e.setQueriesData({queryKey:y},r=>r&&{...r,pages:r.pages.map(u)})})};var d={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(a=>["get-one",e.path,e.params,String(a)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params],getDataQuery:e=>["query-data",e.path,e.params]};function v(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){let a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(let s of a){let u=e[s],y=t[s];if(u!==y&&!v(u,y))return!1}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a]&&!v(e[a],t[a]))return!1;return!0}return e===t}var Ft=({queryClient:e,queryKeys:t})=>{e.invalidateQueries({predicate:a=>{let n=a.queryKey;return t.some(s=>s.every(u=>n.some(y=>v(y,u))))}})};var S=({queryClient:e,queryKeys:t})=>{t.forEach(a=>{e.invalidateQueries({queryKey:a})})};function w(e,t){let a={...e};if(e instanceof Object&&t instanceof Object){for(let n in t)if(n in e){let s=e[n],u=t[n];typeof s==typeof u&&(Array.isArray(s)&&Array.isArray(u)||s!==null&&!Array.isArray(s)&&typeof s=="object"&&!Array.isArray(u)&&typeof u=="object"||typeof s!="object"&&typeof u!="object")&&(typeof s=="object"&&s!==null&&!Array.isArray(s)?a[n]=w(s,u):a[n]=u)}}return a}var Y=({queryClient:e,data:t,ids:a,queryKeysOne:n,queryKeysList:s,queryKeysInfiniteList:u})=>{let y=r=>!r||!(r.data instanceof Array)?r:{...r,data:r.data.map(o=>a.some(p=>String(p)===String(o.id))?w(o,t):o)};n&&n.forEach(r=>{e.setQueriesData({queryKey:r},o=>!o||!(o.data instanceof Object)||!(t instanceof Object)?o:{...o,data:w(o.data,t)})}),s&&s.forEach(r=>{e.setQueriesData({queryKey:r},y)}),u&&u.forEach(r=>{e.setQueriesData({queryKey:r},o=>o&&{...o,pages:o.pages.map(y)})})};var $=async(e,t)=>{let a=t.reduce((n,s)=>n.concat(e.getQueriesData({queryKey:s})),[]);return await Promise.all(a.map(([n])=>e.cancelQueries({queryKey:n}))),a};var X=({resourcePath:e,mutationOptions:t,mode:a={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:s=!0,isInvalidateCache:u=!0,type:y="many"})=>{let{apiUrl:r,apiClient:o,apiEnsureTrailingSlash:p,toastUndo:i}=b(),c=Qe(),Q=xe([]),D=()=>{Q.current.forEach(([m,h])=>{c.setQueryData(m,h)})},{mutate:E,...C}=De({...t,mutationKey:[y==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let h=`${r}/${g(m.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:o,apiUrl:r,variables:m,url:h});let f=y==="many"?m.ids:[m.id],T=await Promise.allSettled(f.map(x=>o({url:`${h}${x}${p?"/":""}`,method:"DELETE",...m.apiClientParams}))),P=[];return T.forEach(x=>{if(x.status==="fulfilled")P.push(x.value);else throw x.reason}),y==="many"?P:P[0]},onSuccess:(...m)=>{let h=m[1],f=[d.getList(h.resource),d.getInfiniteList(h.resource)];n.forEach(T=>{f.push(d.getList(T)),f.push(d.getInfiniteList(T))}),u&&S({queryClient:c,queryKeys:f}),t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),D()}});return{mutation:C,delete:async({resourceParams:m,undoMessage:h,...f})=>{let T={path:e,params:m},P=y==="many"?f.ids:[f.id];if(a.optimistic){let x=s?d.getOneArray(T,P):[],R=s?[d.getList(T)]:[],F=s?[d.getInfiniteList(T)]:[];n.forEach(j=>{x.push(...d.getOneArray(j,P)),R.push(d.getList(j)),F.push(d.getInfiniteList(j))}),Q.current=await $(c,[...x,...R,...F]),J({queryClient:c,ids:P,queryKeysOne:x,queryKeysList:R,queryKeysInfiniteList:F})}if(a.undoable){let x=P.length>1;M.once("end",R=>{R?D():E({...f,resource:T})}),i({message:h||`Element${x?"s":""} deleted`,type:x?"delete-many":"delete-one"})}else E({...f,resource:T})}}},_t=e=>X({...e,type:"one"}),Jt=e=>X({...e,type:"many"});import{useMutation as Ee,useQueryClient as ge}from"@tanstack/react-query";import{useRef as be}from"react";var Z=({resourcePath:e,mutationOptions:t,mode:a={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:s=!0,type:u="many"})=>{let{apiUrl:y,apiClient:r,apiEnsureTrailingSlash:o,toastUndo:p}=b(),i=ge(),c=be([]),Q=()=>{c.current.forEach(([l,m])=>{i.setQueryData(l,m)})},{mutate:D,...E}=Ee({...t,mutationKey:[u==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async l=>{let m=`${y}/${g(l.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:r,apiUrl:y,variables:l,url:m});let h=u==="many"?l.ids:[l.id],f=await Promise.allSettled(h.map(P=>r({url:`${m}${P}${o?"/":""}`,method:"PATCH",data:l.data,...l.apiClientParams}))),T=[];return f.forEach(P=>{if(P.status==="fulfilled")T.push(P.value);else throw P.reason}),u==="many"?T:T[0]},onSuccess:(...l)=>{let m=l[1];if(!a.optimistic){let h=u==="many"?m.ids:[m.id],f=[...d.getOneArray(m.resource,h),d.getList(m.resource),d.getInfiniteList(m.resource)];n.forEach(T=>{f.push(...d.getOneArray(T,h)),f.push(d.getList(T)),f.push(d.getInfiniteList(T))}),S({queryClient:i,queryKeys:f})}t?.onSuccess&&t.onSuccess(...l)},onError:(...l)=>{t?.onError&&t.onError(...l),Q()}});return{mutation:E,update:async({resourceParams:l,undoMessage:m,...h})=>{let f={path:e,params:l},T=u==="many"?h.ids:[h.id];if(a.optimistic){let P=s?d.getOneArray(f,T):[],x=s?[d.getList(f)]:[],R=s?[d.getInfiniteList(f)]:[];n.forEach(F=>{P.push(...d.getOneArray(F,T)),x.push(d.getList(F)),R.push(d.getInfiniteList(F))}),c.current=await $(i,[...P,...x,...R]),Y({queryClient:i,data:h.data,ids:T,queryKeysOne:P,queryKeysList:x,queryKeysInfiniteList:R})}if(a.undoable){let P=T.length>1;M.once("end",x=>{x?Q():D({...h,resource:f})}),p({message:m||`Element${P?"s":""} updated`,type:P?"update-many":"update-one"})}else D({...h,resource:f})}}},oa=e=>Z({...e,type:"one"}),na=e=>Z({...e,type:"many"});import{useMutation as Ce,useQueryClient as Re}from"@tanstack/react-query";var ma=({resourcePath:e,mutationOptions:t,extraResources:a=[],shouldUpdateCurrentResource:n=!0,cacheAddItemTo:s="start",isInvalidateCache:u=!0})=>{let{apiUrl:y,apiClient:r,apiEnsureTrailingSlash:o}=b(),p=Re(),{mutate:i,...c}=Ce({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async D=>{let E=`${y}/${g(D.resource,o)}`;return t?.mutationFn?await t?.mutationFn({apiClient:r,apiUrl:y,variables:D,url:E}):await r({url:E,method:"POST",data:D.data,...D.apiClientParams})},onSuccess:(...D)=>{let E=D[0];if(E){let C=D[1],{id:l}=E.data,m=n?[d.getOne(C.resource,l)]:[],h=n?[d.getList(C.resource)]:[],f=n?[d.getInfiniteList(C.resource)]:[];a.forEach(T=>{m.push(d.getOne(T,l)),h.push(d.getList(T)),f.push(d.getInfiniteList(T))}),_({queryClient:p,data:E.data||{},queryKeysOne:m.map(T=>[...T,{}]),queryKeysList:h,queryKeysInfiniteList:f,cacheAddItemTo:s}),u&&S({queryClient:p,queryKeys:[...h,...f]})}t?.onSuccess&&t.onSuccess(...D)}});return{mutation:c,create:({resourceParams:D,...E})=>{i({...E,resource:{path:e,params:D}})}}};import{useQuery as Ke}from"@tanstack/react-query";var ha=({queryOptions:e,resource:t,params:a={},apiClientParams:n})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:y}=b();return Ke({...e,queryKey:["query-data",t.path,t.params,a,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:o})=>{let p={resource:t,params:a,queryKey:o},i=`${s}/${g(p.resource,y)}`;return e?.queryFn?await e?.queryFn({apiClient:u,apiUrl:s,variables:p,url:i}):await u({url:i,method:"GET",params:a,...n})}})};import{useMutation as Fe}from"@tanstack/react-query";var Ea=({resourcePath:e,mutationOptions:t})=>{let{apiUrl:a,apiClient:n,apiEnsureTrailingSlash:s}=b(),{mutate:u,...y}=Fe({...t,mutationKey:["mutate-data",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async o=>{let p=`${a}/${g(o.resource,s)}`;return t?.mutationFn?await t?.mutationFn({apiClient:n,apiUrl:a,variables:o,url:p}):await n({url:p,data:o.data,...o.apiClientParams})}});return{mutation:y,mutate:async({resourceParams:o,...p})=>{u({...p,resource:{path:e,params:o}})}}};export{A as CustomError,ot as RQWrapper,je as ToastBar,_ as addItemFromQueryCache,J as deleteItemsFromQueryCache,B as fetcher,g as getUrlFromResource,d as helpersQueryKeys,Ft as invalidateMatchingQueries,S as invalidateQueries,Be as resolveToastValue,L as toast,Y as updateItemsFromQueryCache,ma as useCreate,Ea as useDataMutate,ha as useDataQuery,Jt as useDeleteMany,_t as useDeleteOne,dt as useGetInfiniteList,pt as useGetList,xt as useGetOne,b as useRQWrapperContext,na as useUpdateMany,oa as useUpdateOne};
//# sourceMappingURL=index.mjs.map