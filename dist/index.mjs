export*from"@tanstack/react-query";import{useQuery as ye}from"@tanstack/react-query";import J from"eventemitter3";function L(e,t){let o={...e};if(e instanceof Object&&t instanceof Object){for(let n in t)if(n in e){let r=e[n],y=t[n];typeof r==typeof y&&(Array.isArray(r)&&Array.isArray(y)||r!==null&&!Array.isArray(r)&&typeof r=="object"&&!Array.isArray(y)&&typeof y=="object"||typeof r!="object"&&typeof y!="object")&&(typeof r=="object"&&r!==null&&!Array.isArray(r)?o[n]=L(r,y):o[n]=y)}}return o}var S=async(e,t)=>{let o=t.reduce((n,r)=>n.concat(e.getQueriesData({queryKey:r})),[]);return await Promise.all(o.map(([n])=>e.cancelQueries({queryKey:n}))),o};function A(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var w=new J,x={once:(e,t)=>{w.once(e,t)},emit:(e,t)=>{w.emit(e,t)}};var F=e=>{let t=e.path.replace(/{(\w+)}/g,(o,n)=>e.params[n].toString());return A(t)};import{QueryClient as ne,QueryClientProvider as ie}from"@tanstack/react-query";import{ReactQueryDevtools as ue}from"@tanstack/react-query-devtools";import K,{createContext as ce,useCallback as v,useContext as pe,useMemo as k}from"react";var M=class e extends Error{constructor(o,n,r){super(o);this.message=o;this.status=n;this.data=r;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(o).stack,this.stack=new Error().stack,console.error(this.message,this)}};var Y=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([n,r])=>{Array.isArray(r)?r.length>0&&(t[n]=r):r instanceof Object?r&&Object.keys(r).length>0&&(t[n]=r):(r||typeof r=="boolean")&&(t[n]=r)}),t}return{}};function U(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var B=e=>{let{onSuccess:t,onError:o}=e,n=e.data instanceof FormData,r=(()=>{let a=e.url;if(e.params){let i=Y(e.params);if(e.queryParamsSerializer)a+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(i).length>0){let l=[];for(let D in i)i.hasOwnProperty(D)&&(Array.isArray(i[D])?i[D].forEach(C=>{l.push(`${U(D)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${U(C)}`)}):l.push(`${U(D)}=${U(i[D])}`));a+=`?${l.join("&")}`}}let[s,u]=a.split("?");return s.charAt(s.length-1)!=="/"&&!u?`${s}/${`${u?`?${u}`:""}`}`:`${s}${u?`?${u}`:""}`})(),y=n?e.data:e.data?JSON.stringify(e.data):"",c={method:e.method,headers:{...!n&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...y&&{body:y},...e.options};return fetch(r,c).then(async a=>{let s=await(async()=>{try{let i=a.headers.get("Content-Type")?.toLowerCase()||"";return i.includes("application/json")?await a.json():i.includes("text/plain")||i.includes("text/csv")||i.includes("application/xml")||i.includes("text/xml")||i.includes("application/javascript")||i.includes("text/html")?await a.text():i.includes("multipart/form-data")?await a.formData():await a.blob()}catch(i){throw console.error("Error handling response:",i),i}})(),u={};return a.headers.forEach((i,l)=>{u[l]=i}),{status:a.status,statusText:a.statusText,headers:u,data:s}}).then(a=>{if(a.status<200||a.status>=300){let s=new M(`Request failed with status code: ${a.status}`,a.status,a.data);return o&&o(s,e),Promise.reject(s)}return t&&t(a,e),Promise.resolve(a)}).catch(a=>Promise.reject(new M(a.message)))};import q,{useCallback as X}from"react";import{resolveValue as $,useToaster as Z}from"react-hot-toast/headless";var ee=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function te({id:e,className:t,style:o,onHeightUpdate:n,children:r}){let y=X(c=>{if(c){let a=()=>{let{height:s}=c.getBoundingClientRect();n(e,s)};a(),new MutationObserver(a).observe(c,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return q.createElement("div",{ref:y,className:t,style:o},r)}var re=(e,t)=>{let o=e.includes("top"),n=o?{top:0}:{bottom:0},r=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ee()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(o?1:-1)}px)`,...n,...r}},O=16;function j({reverseOrder:e,position:t="top-center",toastOptions:o,gutter:n,children:r,containerStyle:y,containerClassName:c}){let{toasts:a,handlers:s}=Z(o);return q.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...y},className:c,onMouseEnter:s.startPause,onMouseLeave:s.endPause},a.map(u=>{let i=u.position||t,l={...u,position:i},D=s.calculateOffset(l,{reverseOrder:e,gutter:n,defaultPosition:t}),C=re(i,D);return q.createElement(te,{id:l.id,key:l.id,onHeightUpdate:s.updateHeight,style:{...C,pointerEvents:"auto"}},l.type==="custom"?$(u.message,l):r?r(l):q.createElement("div",{style:{display:u.visible?"flex":"none"}},$(l.message,l)))}))}import V from"react-hot-toast/headless";import{ToastBar as ae,resolveValue as se}from"react-hot-toast";var{remove:Ie,...oe}=V,I=Object.assign((...e)=>V(...e),oe),Be=ae,we=se;var W=ce({apiUrl:"",apiClient:B,toastUndo:()=>{}}),Q=()=>pe(W);function _e({children:e,config:t={},apiUrl:o,apiClient:n=B,apiAuthorization:r,apiHeaders:y,apiOnSuccess:c,apiOnError:a,isDevTools:s,devToolsOptions:u,toast:i}){let l=k(()=>new ne({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}}),[]),D=v(p=>{let f=r?r():"",d=y?y():{},P=(...g)=>{c&&c(...g),p.onSuccess&&p.onSuccess(...g)},h=(...g)=>{a&&a(...g),p.onError&&p.onError(...g)};return n({...p,headers:p.headers?{...d,...p.headers}:d,authorization:p.authorization||f,onSuccess:P,onError:h})},[]),C=v(p=>{let f=!1;I.dismiss();let d=()=>{f=!0,x.emit("end",!0),I.dismiss()},P=i?.customUndoContent?i?.customUndoContent({message:p.message,onUndo:d,type:p.type}):null;I.success(h=>(!h.visible&&!f&&(f=!0,x.emit("end",!1)),P||K.createElement(K.Fragment,null,p.message,K.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:d,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:i?.globalProps?.toastOptions?.duration||5e3})},[]),m=k(()=>({apiUrl:A(o),apiClient:D,toastUndo:C}),[o,D,C]);return K.createElement(ie,{client:l},K.createElement(j,{...i?.globalProps},i?.wrapper),K.createElement(W.Provider,{value:m},e),s&&K.createElement(ue,{buttonPosition:"bottom-right",initialIsOpen:!1,...u}))}var et=({queryOptions:e,resource:t,params:o={},apiClientParams:n})=>{let{apiUrl:r,apiClient:y}=Q();return ye({...e,queryKey:["get-list",t.path,t.params,o,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:a})=>{let s={resource:t,params:o,queryKey:a},u=`${r}/${F(s.resource)}/`;return e?.queryFn?await e?.queryFn({apiClient:y,variables:s,url:u}):await y({url:u,method:"GET",params:o,...n})}})};import{useInfiniteQuery as me}from"@tanstack/react-query";var nt=({queryOptions:e,resource:t,params:o={},apiClientParams:n,pagination:r})=>{let{apiUrl:y,apiClient:c}=Q();return me({initialPageParam:1,getNextPageParam:(...s)=>{let u=s[0],i=Number(s[2]);if(u?.data?.length)return i+1},getPreviousPageParam:(...s)=>{let u=Number(s[2]);if(!(u<=1))return u-1},...e,queryKey:["get-infinite-list",t.path,t.params,r,o,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:s,pageParam:u})=>{let i={resource:t,params:{...o,[r.page[0]]:u,[r.per_page[0]]:r.per_page[1]},queryKey:s},l=`${y}/${F(i.resource)}/`;return e?.queryFn?await e?.queryFn({apiClient:c,variables:i,url:l}):await c({url:l,method:"GET",params:i.params,...n})}})};import{useQuery as le}from"@tanstack/react-query";var yt=({resource:e,id:t,queryOptions:o,params:n={},apiClientParams:r})=>{let{apiUrl:y,apiClient:c}=Q();return le({...o,queryKey:["get-one",e.path,e.params,String(t),n,...o?.queryKey?o.queryKey:[]],queryFn:async({queryKey:s})=>{let u={id:t,resource:e,params:n,queryKey:s},i=`${y}/${F(u.resource)}/`;return o?.queryFn?await o?.queryFn({apiClient:c,variables:u,url:i}):await c({url:`${i}${u.id}/`,method:"GET",params:n,...r})}})};import{useMutation as fe,useQueryClient as he}from"@tanstack/react-query";import{useRef as Te}from"react";var z=({queryClient:e,ids:t,queryKeysOne:o,queryKeysList:n,queryKeysInfiniteList:r})=>{let y=c=>!c||!(c.data instanceof Array)?c:{...c,data:c.data.filter(a=>!t.some(s=>String(s)===String(a.id)))};o&&o.forEach(c=>{e.removeQueries({queryKey:c})}),n&&n.forEach(c=>{e.setQueriesData({queryKey:c},y)}),r&&r.forEach(c=>{e.setQueriesData({queryKey:c},a=>a&&{...a,pages:a.pages.map(y)})})},N=({queryClient:e,data:t,ids:o,queryKeysOne:n,queryKeysList:r,queryKeysInfiniteList:y})=>{let c=a=>!a||!(a.data instanceof Array)?a:{...a,data:a.data.map(s=>o.some(u=>String(u)===String(s.id))?L(s,t):s)};n&&n.forEach(a=>{e.setQueriesData({queryKey:a},s=>!s||!(s.data instanceof Object)||!(t instanceof Object)?s:{...s,data:L(s.data,t)})}),r&&r.forEach(a=>{e.setQueriesData({queryKey:a},c)}),y&&y.forEach(a=>{e.setQueriesData({queryKey:a},s=>s&&{...s,pages:s.pages.map(c)})})},T={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(o=>["get-one",e.path,e.params,String(o)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params]};var E=({queryClient:e,queryKeys:t})=>{t.forEach(o=>{e.invalidateQueries({queryKey:o})})},G=({queryClient:e,queryKeys:t,data:o})=>{t.forEach(n=>{e.setQueryData(n,o)})};var H=({resourcePath:e,mutationOptions:t,mode:o={optimistic:!0,undoable:!0},extraResources:n=[],type:r="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:a}=Q(),s=he(),u=Te([]),i=()=>{u.current.forEach(([m,p])=>{s.setQueryData(m,p)})},{mutate:l,...D}=fe({...t,mutationKey:[r==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let p=`${y}/${F(m.resource)}/`;if(t?.mutationFn)return await t?.mutationFn({apiClient:c,variables:m,url:p});let f=r==="many"?m.ids:[m.id],d=await Promise.allSettled(f.map(h=>c({url:`${p}${h}/`,method:"DELETE",...m.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),r==="many"?P:P[0]},onSuccess:(...m)=>{let p=m[1],f=[T.getList(p.resource),T.getInfiniteList(p.resource)];n.forEach(d=>{f.push(T.getList(d)),f.push(T.getInfiniteList(d))}),E({queryClient:s,queryKeys:f}),t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),i()}});return{mutation:D,delete:async({resourceParams:m,undoMessage:p,...f})=>{let d={path:e,params:m},P=r==="many"?f.ids:[f.id];if(o.optimistic){let h=T.getOneArray(d,P),g=[T.getList(d)],R=[T.getInfiniteList(d)];n.forEach(b=>{h.push(...T.getOneArray(b,P)),g.push(T.getList(b)),R.push(T.getInfiniteList(b))}),u.current=await S(s,[...h,...g,...R]),z({queryClient:s,ids:P,queryKeysOne:h,queryKeysList:g,queryKeysInfiniteList:R})}if(o.undoable){let h=P.length>1;x.once("end",g=>{g?i():l({...f,resource:d})}),a({message:p||`Element${h?"s":""} deleted`,type:h?"delete-many":"delete-one"})}else l({...f,resource:d})}}},Qt=e=>H({...e,type:"one"}),Rt=e=>H({...e,type:"many"});import{useMutation as de,useQueryClient as Pe}from"@tanstack/react-query";import{useRef as De}from"react";var _=({resourcePath:e,mutationOptions:t,mode:o={optimistic:!0,undoable:!0},extraResources:n=[],type:r="many"})=>{let{apiUrl:y,apiClient:c,toastUndo:a}=Q(),s=Pe(),u=De([]),i=()=>{u.current.forEach(([m,p])=>{s.setQueryData(m,p)})},{mutate:l,...D}=de({...t,mutationKey:[r==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let p=`${y}/${F(m.resource)}/`;if(t?.mutationFn)return await t?.mutationFn({apiClient:c,variables:m,url:p});let f=r==="many"?m.ids:[m.id],d=await Promise.allSettled(f.map(h=>c({url:`${p}${h}/`,method:"PATCH",data:m.data,...m.apiClientParams}))),P=[];return d.forEach(h=>{if(h.status==="fulfilled")P.push(h.value);else throw h.reason}),r==="many"?P:P[0]},onSuccess:(...m)=>{let p=m[1];if(!o.optimistic){let f=r==="many"?p.ids:[p.id],d=[...T.getOneArray(p.resource,f),T.getList(p.resource),T.getInfiniteList(p.resource)];n.forEach(P=>{d.push(...T.getOneArray(P,f)),d.push(T.getList(P)),d.push(T.getInfiniteList(P))}),E({queryClient:s,queryKeys:d})}t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),i()}});return{mutation:D,update:async({resourceParams:m,undoMessage:p,...f})=>{let d={path:e,params:m},P=r==="many"?f.ids:[f.id];if(o.optimistic){let h=T.getOneArray(d,P),g=[T.getList(d)],R=[T.getInfiniteList(d)];n.forEach(b=>{h.push(...T.getOneArray(b,P)),g.push(T.getList(b)),R.push(T.getInfiniteList(b))}),u.current=await S(s,[...h,...g,...R]),N({queryClient:s,data:f.data,ids:P,queryKeysOne:h,queryKeysList:g,queryKeysInfiniteList:R})}if(o.undoable){let h=P.length>1;x.once("end",g=>{g?i():l({...f,resource:d})}),a({message:p||`Element${h?"s":""} updated`,type:h?"update-many":"update-one"})}else l({...f,resource:d})}}},Ut=e=>_({...e,type:"one"}),Ot=e=>_({...e,type:"many"});import{useMutation as ge,useQueryClient as Ce}from"@tanstack/react-query";var Vt=({resourcePath:e,mutationOptions:t,extraResources:o=[]})=>{let{apiUrl:n,apiClient:r}=Q(),y=Ce(),{mutate:c,...a}=ge({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async u=>{let i=`${n}/${F(u.resource)}/`;return t?.mutationFn?await t?.mutationFn({apiClient:r,variables:u,url:i}):await r({url:i,method:"POST",data:u.data,...u.apiClientParams})},onSuccess:(...u)=>{let i=u[0],l=u[1],{id:D}=i.data,C=[T.getOne(l.resource,D)],m=[T.getList(l.resource)],p=[T.getInfiniteList(l.resource)];o.forEach(f=>{C.push(T.getOne(f,D)),m.push(T.getList(f)),p.push(T.getInfiniteList(f))}),G({queryClient:y,queryKeys:C.map(f=>[...f,{}]),data:u[0]}),E({queryClient:y,queryKeys:[...m,...p]}),t?.onSuccess&&t.onSuccess(...u)}});return{mutation:a,create:({resourceParams:u,...i})=>{c({...i,resource:{path:e,params:u}})}}};export{M as CustomError,_e as RQWrapper,Be as ToastBar,z as deleteItemsFromQueryCache,B as fetcher,F as getUrlFromResource,T as helpersQueryKeys,we as resolveToastValue,I as toast,N as updateItemsFromQueryCache,Vt as useCreate,Rt as useDeleteMany,Qt as useDeleteOne,nt as useGetInfiniteList,et as useGetList,yt as useGetOne,Q as useRQWrapperContext,Ot as useUpdateMany,Ut as useUpdateOne};
//# sourceMappingURL=index.mjs.map