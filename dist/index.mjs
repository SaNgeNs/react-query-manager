export*from"@tanstack/react-query";import{useQuery as xe}from"@tanstack/react-query";function I(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var C=(e,t)=>{let r=I(e.path.replace(/{(\w+)}/g,(n,a)=>e.params[a].toString()));return t?`${r}/`:r};import{QueryClient as de,QueryClientProvider as he}from"@tanstack/react-query";import{ReactQueryDevtools as Pe}from"@tanstack/react-query-devtools";import F,{createContext as De,useCallback as H,useContext as Qe,useMemo as J}from"react";var A=class e extends Error{constructor(r,n,a){super(r);this.message=r;this.status=n;this.data=a;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(r).stack,this.stack=new Error().stack,console.error(this.message,this)}};var ne=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([n,a])=>{(a||typeof a=="boolean"||typeof a=="number")&&(t[n]=a)}),t}return{}};function v(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var k=e=>{let{onSuccess:t,onError:r}=e,n=e.data instanceof FormData,a=(()=>{let s=e.url;if(e.params){let y=ne(e.params);if(e.queryParamsSerializer)s+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(y).length>0){let c=[];for(let f in y)y.hasOwnProperty(f)&&(Array.isArray(y[f])?y[f].forEach(Q=>{c.push(`${v(f)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${v(Q)}`)}):c.push(`${v(f)}=${v(y[f])}`));s+=`?${c.join("&")}`}}let[u,p]=s.split("?");return`${u}${p?`?${p}`:""}`})(),i=n?e.data:e.data?JSON.stringify(e.data):"",o={method:e.method,headers:{...!n&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...i&&{body:i},...e.options};return fetch(a,o).then(async s=>{let u=await(async()=>{try{let y=s.headers.get("Content-Type")?.toLowerCase()||"";return y.includes("application/json")?await s.json():y.includes("text/plain")||y.includes("text/csv")||y.includes("application/xml")||y.includes("text/xml")||y.includes("application/javascript")||y.includes("text/html")?await s.text():y.includes("multipart/form-data")?await s.formData():await s.blob()}catch(y){throw console.error("Error handling response:",y),y}})(),p={};return s.headers.forEach((y,c)=>{p[c]=y}),{status:s.status,statusText:s.statusText,headers:p,data:u}}).then(s=>{if(s.status<200||s.status>=300){let u=new A(`Request failed with status code: ${s.status}`,s.status,s.data);return r&&r(u,e),Promise.reject(u)}return t&&t(s,e),Promise.resolve(s)}).catch(s=>Promise.reject(new A(s.message)))};import U,{useCallback as ie}from"react";import{resolveValue as W,useToaster as ue}from"react-hot-toast/headless";var ye=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"&&window.matchMedia){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function pe({id:e,className:t,style:r,onHeightUpdate:n,children:a}){let i=ie(o=>{if(o){let s=()=>{let{height:u}=o.getBoundingClientRect();n(e,u)};s(),new MutationObserver(s).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return U.createElement("div",{"data-toast-id":e,ref:i,className:t,style:r},a)}var ce=(e,t)=>{let r=e.includes("top"),n=r?{top:0}:{bottom:0},a=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ye()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...n,...a}},j=16;function _({reverseOrder:e,position:t="top-center",toastOptions:r,gutter:n,children:a,containerStyle:i,containerClassName:o}){let{toasts:s,handlers:u}=ue(r);return U.createElement("div",{style:{position:"fixed",zIndex:9999,top:j,left:j,right:j,bottom:j,pointerEvents:"none",...i},className:o,onMouseEnter:u.startPause,onMouseLeave:u.endPause},s.map(p=>{let y=p.position||t,c={...p,position:y},f=u.calculateOffset(c,{reverseOrder:e,gutter:n,defaultPosition:t}),Q=ce(y,f),g=a;return U.createElement(pe,{id:c.id,key:c.id,onHeightUpdate:u.updateHeight,style:{...Q,pointerEvents:"auto"}},c.type==="custom"?W(p.message,c):g?U.createElement(g,{...c}):U.createElement("div",{style:{display:p.visible?"flex":"none"}},W(c.message,c)))}))}import z from"react-hot-toast/headless";import{ToastBar as me,resolveValue as le}from"react-hot-toast";var{remove:ze,...Te}=z,w=Object.assign((...e)=>z(...e),Te),Ge=me,He=le;import fe from"eventemitter3";var G=new fe,S={once:(e,t)=>{G.once(e,t)},emit:(e,t)=>{G.emit(e,t)}};var q=process.env.NODE_ENV==="test";var N={queryClient:{}},E=()=>N.queryClient;var Y=De({apiUrl:"",apiEnsureTrailingSlash:!1,apiClient:k,toastUndo:()=>{}}),b=()=>Qe(Y);function lt({children:e,config:t={},apiUrl:r,apiClient:n=k,apiEnsureTrailingSlash:a=!1,apiAuthorization:i,apiHeaders:o,apiOnSuccess:s,apiOnError:u,isDevTools:p,devToolsOptions:y,toast:c}){let f=J(()=>{let m=new de({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}});return N.queryClient=m,m},[]),Q=H(m=>{let l=i?i():"",T=o?o():{},h=(...d)=>{s&&s(...d),m.onSuccess&&m.onSuccess(...d)},P=(...d)=>{u&&u(...d),m.onError&&m.onError(...d)};return n({...m,headers:m.headers?{...T,...m.headers}:T,authorization:m.authorization||l,onSuccess:h,onError:P})},[]),g=H(m=>{let l=!1;w.dismiss();let T=()=>{l=!0,S.emit("end",!0),w.dismiss()};q||w.success(h=>{let P=c?.CustomUndoContent;return!h.visible&&!l&&(l=!0,S.emit("end",!1)),P?F.createElement(P,{message:m.message,onUndo:T,type:m.type,toast:h}):F.createElement(F.Fragment,null,m.message,F.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:T,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))},{duration:c?.globalProps?.toastOptions?.duration||5e3})},[]),R=J(()=>({apiUrl:I(r),apiClient:Q,apiEnsureTrailingSlash:a,toastUndo:g}),[r,Q,g,a]);return F.createElement(he,{client:f},!q&&F.createElement(_,{...c?.globalProps},c?.CustomContent),F.createElement(Y.Provider,{value:R},e),p&&F.createElement(Pe,{buttonPosition:"bottom-right",initialIsOpen:!1,...y}))}var Pt=({queryOptions:e,resource:t,params:r={},apiClientParams:n})=>{let{apiUrl:a,apiClient:i,apiEnsureTrailingSlash:o}=b();return xe({...e,queryKey:["get-list",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:u})=>{let p={resource:t,params:r,queryKey:u},y=`${a}/${C(p.resource,o)}`;return e?.queryFn?await e?.queryFn({apiClient:i,apiUrl:a,variables:p,url:y}):await i({url:y,method:"GET",params:r,...n})}})};import{useInfiniteQuery as Ee}from"@tanstack/react-query";var Ct=({queryOptions:e,resource:t,params:r={},apiClientParams:n,pagination:a})=>{let{apiUrl:i,apiClient:o,apiEnsureTrailingSlash:s}=b();return Ee({initialPageParam:1,getNextPageParam:(...p)=>{let y=p[0],c=Number(p[2]);if(y?.data?.length)return c+1},getPreviousPageParam:(...p)=>{let y=Number(p[2]);if(!(y<=1))return y-1},...e,queryKey:["get-infinite-list",t.path,t.params,a,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:p,pageParam:y})=>{let c={resource:t,params:{...r,[a.page[0]]:y,[a.per_page[0]]:a.per_page[1]},queryKey:p},f=`${i}/${C(c.resource,s)}`;return e?.queryFn?await e?.queryFn({apiClient:o,apiUrl:i,variables:c,url:f}):await o({url:f,method:"GET",params:c.params,...n})}})};import{useQuery as ge}from"@tanstack/react-query";var Mt=({resource:e,id:t,queryOptions:r,params:n={},apiClientParams:a})=>{let{apiUrl:i,apiClient:o,apiEnsureTrailingSlash:s}=b();return ge({...r,queryKey:["get-one",e.path,e.params,String(t),n,...r?.queryKey?r.queryKey:[]],queryFn:async({queryKey:p})=>{let y={id:t,resource:e,params:n,queryKey:p},c=`${i}/${C(y.resource,!0)}`;return r?.queryFn?await r?.queryFn({apiClient:o,apiUrl:i,variables:y,url:c}):await o({url:`${c}${y.id}${s?"/":""}`,method:"GET",params:n,...a})}})};import{useMutation as be,useQueryClient as Re}from"@tanstack/react-query";import{useRef as Ke}from"react";var X=({data:e,queryKeysOne:t})=>{let r=E();t&&t.forEach(n=>{r.setQueryData(n,e)})};var Z=({data:e,queryKeysList:t,queryKeysInfiniteList:r,cacheAddItemTo:n="start"})=>{let a=E(),i=o=>!o||!(o.data instanceof Array)?o:{...o,data:n==="start"?[...e,...o.data]:[...o.data,...e]};t&&t.forEach(o=>{a.setQueriesData({queryKey:o},i)}),r&&r.forEach(o=>{a.setQueriesData({queryKey:o},s=>s&&{...s,pages:s.pages.map(i)})})};var ee=({queryKeys:e})=>{let t=E();e.forEach(r=>{t.removeQueries({queryKey:r})})};var te=({ids:e,queryKeysOne:t,queryKeysList:r,queryKeysInfiniteList:n})=>{let a=E(),i=o=>!o||!(o.data instanceof Array)?o:{...o,data:o.data.filter(s=>!e.some(u=>String(u)===String(s.id)))};t&&ee({queryKeys:t}),r&&r.forEach(o=>{a.setQueriesData({queryKey:o},i)}),n&&n.forEach(o=>{a.setQueriesData({queryKey:o},s=>s&&{...s,pages:s.pages.map(i)})})};var D={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(r=>["get-one",e.path,e.params,String(r)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params],getDataQuery:e=>["query-data",e.path,e.params]};function L(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let a of r){let i=e[a],o=t[a];if(i!==o&&!L(i,o))return!1}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]&&!L(e[r],t[r]))return!1;return!0}return e===t}var Nt=({queryKeys:e})=>{E().invalidateQueries({predicate:r=>{let n=r.queryKey;return e.some(a=>a.every(i=>n.some(o=>L(o,i))))}})};var Gt=({queryKeys:e})=>{E().removeQueries({predicate:r=>{let n=r.queryKey;return e.some(a=>a.every(i=>n.some(o=>L(o,i))))}})};var O=({queryKeys:e})=>{let t=E();e.forEach(r=>{t.invalidateQueries({queryKey:r})})};function re(e){return!Number.isNaN(Number(e))}function Ce(e,t){return re(e)&&re(t)}function V(e,t){let r={...e};if(e instanceof Object&&t instanceof Object){for(let n in t)if(n in e){let a=e[n],i=t[n],o=typeof a==typeof i&&(Array.isArray(a)&&Array.isArray(i)||a!==null&&!Array.isArray(a)&&typeof a=="object"&&!Array.isArray(i)&&typeof i=="object"||typeof a!="object"&&typeof i!="object"),s=Ce(a,i);(o||s)&&(typeof a=="object"&&a!==null&&!Array.isArray(a)?r[n]=V(a,i):r[n]=i)}}return r}var ae=({data:e,ids:t,queryKeysOne:r,queryKeysList:n,queryKeysInfiniteList:a})=>{let i=E(),o=s=>!s||!(s.data instanceof Array)?s:{...s,data:s.data.map(u=>t.some(p=>String(p)===String(u.id))?V(u,e):u)};r&&r.forEach(s=>{i.setQueriesData({queryKey:s},u=>!u||!(u.data instanceof Object)||!(e instanceof Object)?u:{...u,data:V(u.data,e)})}),n&&n.forEach(s=>{i.setQueriesData({queryKey:s},o)}),a&&a.forEach(s=>{i.setQueriesData({queryKey:s},u=>u&&{...u,pages:u.pages.map(o)})})};var $=async e=>{let t=E(),r=e.reduce((n,a)=>n.concat(t.getQueriesData({queryKey:a})),[]);return await Promise.all(r.map(([n])=>t.cancelQueries({queryKey:n}))),r};var se=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:a=!0,isInvalidateCache:i=!0,type:o="many"})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:p,toastUndo:y}=b(),c=Re(),f=Ke([]),Q=()=>{f.current.forEach(([l,T])=>{c.setQueryData(l,T)})},{mutate:g,...R}=be({...t,mutationKey:[o==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async l=>{let T=`${s}/${C(l.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:u,apiUrl:s,variables:l,url:T});let h=o==="many"?l.ids:[l.id],P=await Promise.allSettled(h.map(x=>u({url:`${T}${x}${p?"/":""}`,method:"DELETE",...l.apiClientParams}))),d=[];return P.forEach(x=>{if(x.status==="fulfilled")d.push(x.value);else throw x.reason}),o==="many"?d:d[0]},onSuccess:(...l)=>{let T=l[1],h=[D.getList(T.resource),D.getInfiniteList(T.resource)];n.forEach(P=>{h.push(D.getList(P)),h.push(D.getInfiniteList(P))}),i&&O({queryKeys:h}),t?.onSuccess&&t.onSuccess(...l)},onError:(...l)=>{t?.onError&&t.onError(...l),Q()}});return{mutation:R,delete:async({resourceParams:l,undoMessage:T,...h})=>{let P={path:e,params:l},d=o==="many"?h.ids:[h.id];if(r.optimistic){let x=a?D.getOneArray(P,d):[],K=a?[D.getList(P)]:[],M=a?[D.getInfiniteList(P)]:[];n.forEach(B=>{x.push(...D.getOneArray(B,d)),K.push(D.getList(B)),M.push(D.getInfiniteList(B))}),f.current=await $([...x,...K,...M]),te({ids:d,queryKeysOne:x,queryKeysList:K,queryKeysInfiniteList:M})}if(r.undoable&&!q){let x=d.length>1;S.once("end",K=>{K?Q():g({...h,resource:P})}),y({message:T||`Element${x?"s":""} deleted`,type:x?"delete-many":"delete-one"})}else g({...h,resource:P})}}},Er=e=>se({...e,type:"one"}),gr=e=>se({...e,type:"many"});import{useMutation as Fe,useQueryClient as Me}from"@tanstack/react-query";import{useRef as Se}from"react";var oe=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:n=[],shouldUpdateCurrentResource:a=!0,type:i="many"})=>{let{apiUrl:o,apiClient:s,apiEnsureTrailingSlash:u,toastUndo:p}=b(),y=Me(),c=Se([]),f=()=>{c.current.forEach(([m,l])=>{y.setQueryData(m,l)})},{mutate:Q,...g}=Fe({...t,mutationKey:[i==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async m=>{let l=`${o}/${C(m.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:s,apiUrl:o,variables:m,url:l});let T=i==="many"?m.ids:[m.id],h=await Promise.allSettled(T.map(d=>s({url:`${l}${d}${u?"/":""}`,method:"PATCH",data:m.data,...m.apiClientParams}))),P=[];return h.forEach(d=>{if(d.status==="fulfilled")P.push(d.value);else throw d.reason}),i==="many"?P:P[0]},onSuccess:(...m)=>{let l=m[1];if(!r.optimistic){let T=i==="many"?l.ids:[l.id],h=[...D.getOneArray(l.resource,T),D.getList(l.resource),D.getInfiniteList(l.resource)];n.forEach(P=>{h.push(...D.getOneArray(P,T)),h.push(D.getList(P)),h.push(D.getInfiniteList(P))}),O({queryKeys:h})}t?.onSuccess&&t.onSuccess(...m)},onError:(...m)=>{t?.onError&&t.onError(...m),f()}});return{mutation:g,update:async({resourceParams:m,undoMessage:l,...T})=>{let h={path:e,params:m},P=i==="many"?T.ids:[T.id];if(r.optimistic){let d=a?D.getOneArray(h,P):[],x=a?[D.getList(h)]:[],K=a?[D.getInfiniteList(h)]:[];n.forEach(M=>{d.push(...D.getOneArray(M,P)),x.push(D.getList(M)),K.push(D.getInfiniteList(M))}),c.current=await $([...d,...x,...K]),ae({data:T.data,ids:P,queryKeysOne:d,queryKeysList:x,queryKeysInfiniteList:K})}if(r.undoable&&!q){let d=P.length>1;S.once("end",x=>{x?f():Q({...T,resource:h})}),p({message:l||`Element${d?"s":""} updated`,type:d?"update-many":"update-one"})}else Q({...T,resource:h})}}},Or=e=>oe({...e,type:"one"}),Ar=e=>oe({...e,type:"many"});import{useMutation as qe}from"@tanstack/react-query";var Vr=({resourcePath:e,mutationOptions:t,extraResources:r=[],shouldUpdateCurrentResource:n=!0,cacheAddItemTo:a="start",isInvalidateCache:i=!0})=>{let{apiUrl:o,apiClient:s,apiEnsureTrailingSlash:u}=b(),{mutate:p,...y}=qe({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async f=>{let Q=`${o}/${C(f.resource,u)}`;return t?.mutationFn?await t?.mutationFn({apiClient:s,apiUrl:o,variables:f,url:Q}):await s({url:Q,method:"POST",data:f.data,...f.apiClientParams})},onSuccess:(...f)=>{let Q=f[0];if(Q){let g=f[1],R=n?[D.getList(g.resource)]:[],m=n?[D.getInfiniteList(g.resource)]:[];r.forEach(T=>{R.push(D.getList(T)),m.push(D.getInfiniteList(T))});let l=Array.isArray(Q)?Q:[Q];l.forEach(T=>{let{id:h}=T.data,P=n?[D.getOne(g.resource,h)]:[];r.forEach(d=>{P.push(D.getOne(d,h))}),X({data:T.data||{},queryKeysOne:P.map(d=>[...d,{}])})}),Z({data:l.map(T=>T?.data||{}),cacheAddItemTo:a,queryKeysInfiniteList:m,queryKeysList:R}),i&&O({queryKeys:[...R,...m]})}t?.onSuccess&&t.onSuccess(...f)}});return{mutation:y,create:({resourceParams:f,...Q})=>{p({...Q,resource:{path:e,params:f}})}}};import{useQuery as Le}from"@tanstack/react-query";var Wr=({queryOptions:e,resource:t,params:r={},apiClientParams:n})=>{let{apiUrl:a,apiClient:i,apiEnsureTrailingSlash:o}=b();return Le({...e,queryKey:["query-data",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:u})=>{let p={resource:t,params:r,queryKey:u},y=`${a}/${C(p.resource,o)}`;return e?.queryFn?await e?.queryFn({apiClient:i,apiUrl:a,variables:p,url:y}):await i({url:y,method:"GET",params:r,...n})}})};import{useMutation as Oe}from"@tanstack/react-query";var Jr=({resourcePath:e,mutationOptions:t})=>{let{apiUrl:r,apiClient:n,apiEnsureTrailingSlash:a}=b(),{mutate:i,...o}=Oe({...t,mutationKey:["mutate-data",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async u=>{let p=`${r}/${C(u.resource,a)}`;return t?.mutationFn?await t?.mutationFn({apiClient:n,apiUrl:r,variables:u,url:p}):await n({url:p,data:u.data,...u.apiClientParams})}});return{mutation:o,mutate:async({resourceParams:u,...p})=>{i({...p,resource:{path:e,params:u}})}}};export{A as CustomError,lt as RQWrapper,Ge as ToastBar,X as addItemToQueryCache,Z as addItemsToListQueryCache,te as deleteItemsFromQueryCache,k as fetcher,C as getUrlFromResource,D as helpersQueryKeys,Nt as invalidateMatchingQueries,O as invalidateQueries,Gt as removeMatchingQueries,ee as removeQueries,He as resolveToastValue,w as toast,ae as updateItemsFromQueryCache,Vr as useCreate,Jr as useDataMutate,Wr as useDataQuery,gr as useDeleteMany,Er as useDeleteOne,Ct as useGetInfiniteList,Pt as useGetList,Mt as useGetOne,b as useRQWrapperContext,Ar as useUpdateMany,Or as useUpdateOne};
//# sourceMappingURL=index.mjs.map