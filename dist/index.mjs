export*from"@tanstack/react-query";import{useQuery as fe}from"@tanstack/react-query";function A(e){return e.replace(/^\/+/,"").replace(/\/+$/,"")}var g=(e,t)=>{let r=A(e.path.replace(/{(\w+)}/g,(o,s)=>e.params[s].toString()));return t?`${r}/`:r};import{QueryClient as ye,QueryClientProvider as pe}from"@tanstack/react-query";import{ReactQueryDevtools as ce}from"@tanstack/react-query-devtools";import M,{createContext as me,useCallback as z,useContext as le,useMemo as N}from"react";var S=class e extends Error{constructor(r,o,s){super(r);this.message=r;this.status=o;this.data=s;Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(r).stack,this.stack=new Error().stack,console.error(this.message,this)}};var Z=e=>{if(e!==null&&typeof e=="object"){let t={};return Object.entries(e).forEach(([o,s])=>{(s||typeof s=="boolean"||typeof s=="number")&&(t[o]=s)}),t}return{}};function U(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var V=e=>{let{onSuccess:t,onError:r}=e,o=e.data instanceof FormData,s=(()=>{let a=e.url;if(e.params){let i=Z(e.params);if(e.queryParamsSerializer)a+=`?${e.queryParamsSerializer(e.params)}`;else if(Object.keys(i).length>0){let m=[];for(let l in i)i.hasOwnProperty(l)&&(Array.isArray(i[l])?i[l].forEach(D=>{m.push(`${U(l)}${e.queryArrayParamStyle==="indexedArray"?"[]":""}=${U(D)}`)}):m.push(`${U(l)}=${U(i[l])}`));a+=`?${m.join("&")}`}}let[n,c]=a.split("?");return`${n}${c?`?${c}`:""}`})(),u=o?e.data:e.data?JSON.stringify(e.data):"",y={method:e.method,headers:{...!o&&{"Content-Type":"application/json"},...e.authorization&&{Authorization:e.authorization},...e.headers},...u&&{body:u},...e.options};return fetch(s,y).then(async a=>{let n=await(async()=>{try{let i=a.headers.get("Content-Type")?.toLowerCase()||"";return i.includes("application/json")?await a.json():i.includes("text/plain")||i.includes("text/csv")||i.includes("application/xml")||i.includes("text/xml")||i.includes("application/javascript")||i.includes("text/html")?await a.text():i.includes("multipart/form-data")?await a.formData():await a.blob()}catch(i){throw console.error("Error handling response:",i),i}})(),c={};return a.headers.forEach((i,m)=>{c[m]=i}),{status:a.status,statusText:a.statusText,headers:c,data:n}}).then(a=>{if(a.status<200||a.status>=300){let n=new S(`Request failed with status code: ${a.status}`,a.status,a.data);return r&&r(n,e),Promise.reject(n)}return t&&t(a,e),Promise.resolve(a)}).catch(a=>Promise.reject(new S(a.message)))};import q,{useCallback as ee}from"react";import{resolveValue as j,useToaster as te}from"react-hot-toast/headless";var re=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})();function ae({id:e,className:t,style:r,onHeightUpdate:o,children:s}){let u=ee(y=>{if(y){let a=()=>{let{height:n}=y.getBoundingClientRect();o(e,n)};a(),new MutationObserver(a).observe(y,{subtree:!0,childList:!0,characterData:!0})}},[e,o]);return q.createElement("div",{ref:u,className:t,style:r},s)}var se=(e,t)=>{let r=e.includes("top"),o=r?{top:0}:{bottom:0},s=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:re()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...o,...s}},O=16;function v({reverseOrder:e,position:t="top-center",toastOptions:r,gutter:o,children:s,containerStyle:u,containerClassName:y}){let{toasts:a,handlers:n}=te(r);return q.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...u},className:y,onMouseEnter:n.startPause,onMouseLeave:n.endPause},a.map(c=>{let i=c.position||t,m={...c,position:i},l=n.calculateOffset(m,{reverseOrder:e,gutter:o,defaultPosition:t}),D=se(i,l);return q.createElement(ae,{id:m.id,key:m.id,onHeightUpdate:n.updateHeight,style:{...D,pointerEvents:"auto"}},m.type==="custom"?j(c.message,m):s?s(m):q.createElement("div",{style:{display:c.visible?"flex":"none"}},j(m.message,m)))}))}import k from"react-hot-toast/headless";import{ToastBar as oe,resolveValue as ne}from"react-hot-toast";var{remove:Ve,...ie}=k,I=Object.assign((...e)=>k(...e),ie),je=oe,ve=ne;import ue from"eventemitter3";var W=new ue,F={once:(e,t)=>{W.once(e,t)},emit:(e,t)=>{W.emit(e,t)}};var G=me({apiUrl:"",apiEnsureTrailingSlash:!1,apiClient:V,toastUndo:()=>{}}),R=()=>le(G);function rt({children:e,config:t={},apiUrl:r,apiClient:o=V,apiEnsureTrailingSlash:s=!1,apiAuthorization:u,apiHeaders:y,apiOnSuccess:a,apiOnError:n,isDevTools:c,devToolsOptions:i,toast:m}){let l=N(()=>new ye({...t,defaultOptions:{...t?.defaultOptions,queries:{gcTime:3e5,staleTime:3e5,retry:!1,...t?.defaultOptions?.queries}}}),[]),D=z(p=>{let d=u?u():"",h=y?y():{},f=(...T)=>{a&&a(...T),p.onSuccess&&p.onSuccess(...T)},Q=(...T)=>{n&&n(...T),p.onError&&p.onError(...T)};return o({...p,headers:p.headers?{...h,...p.headers}:h,authorization:p.authorization||d,onSuccess:f,onError:Q})},[]),C=z(p=>{let d=!1;I.dismiss();let h=()=>{d=!0,F.emit("end",!0),I.dismiss()},f=m?.customUndoContent?m?.customUndoContent({message:p.message,onUndo:h,type:p.type}):null;I.success(Q=>(!Q.visible&&!d&&(d=!0,F.emit("end",!1)),f||M.createElement(M.Fragment,null,p.message,M.createElement("span",{style:{marginLeft:"10px",cursor:"pointer"},onClick:h,role:"button",tabIndex:0,"aria-label":"Undo",title:"Undo"},"UNDO"))),{duration:m?.globalProps?.toastOptions?.duration||5e3})},[]),x=N(()=>({apiUrl:A(r),apiClient:D,apiEnsureTrailingSlash:s,toastUndo:C}),[r,D,C,s]);return M.createElement(pe,{client:l},M.createElement(v,{...m?.globalProps},m?.wrapper),M.createElement(G.Provider,{value:x},e),c&&M.createElement(ce,{buttonPosition:"bottom-right",initialIsOpen:!1,...i}))}var it=({queryOptions:e,resource:t,params:r={},apiClientParams:o})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:y}=R();return fe({...e,queryKey:["get-list",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:n})=>{let c={resource:t,params:r,queryKey:n},i=`${s}/${g(c.resource,y)}`;return e?.queryFn?await e?.queryFn({apiClient:u,variables:c,url:i}):await u({url:i,method:"GET",params:r,...o})}})};import{useInfiniteQuery as Te}from"@tanstack/react-query";var lt=({queryOptions:e,resource:t,params:r={},apiClientParams:o,pagination:s})=>{let{apiUrl:u,apiClient:y,apiEnsureTrailingSlash:a}=R();return Te({initialPageParam:1,getNextPageParam:(...c)=>{let i=c[0],m=Number(c[2]);if(i?.data?.length)return m+1},getPreviousPageParam:(...c)=>{let i=Number(c[2]);if(!(i<=1))return i-1},...e,queryKey:["get-infinite-list",t.path,t.params,s,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:c,pageParam:i})=>{let m={resource:t,params:{...r,[s.page[0]]:i,[s.per_page[0]]:s.per_page[1]},queryKey:c},l=`${u}/${g(m.resource,a)}`;return e?.queryFn?await e?.queryFn({apiClient:y,variables:m,url:l}):await y({url:l,method:"GET",params:m.params,...o})}})};import{useQuery as de}from"@tanstack/react-query";var Pt=({resource:e,id:t,queryOptions:r,params:o={},apiClientParams:s})=>{let{apiUrl:u,apiClient:y,apiEnsureTrailingSlash:a}=R();return de({...r,queryKey:["get-one",e.path,e.params,String(t),o,...r?.queryKey?r.queryKey:[]],queryFn:async({queryKey:c})=>{let i={id:t,resource:e,params:o,queryKey:c},m=`${u}/${g(i.resource,!0)}`;return r?.queryFn?await r?.queryFn({apiClient:y,variables:i,url:m}):await y({url:`${m}${i.id}${a?"/":""}`,method:"GET",params:o,...s})}})};import{useMutation as he,useQueryClient as Pe}from"@tanstack/react-query";import{useRef as Qe}from"react";var H=({queryClient:e,data:t,queryKeysOne:r,queryKeysList:o,queryKeysInfiniteList:s,cacheAddItemTo:u="start"})=>{let y=a=>!a||!(a.data instanceof Array)?a:{...a,data:u==="start"?[t,...a.data]:[...a.data,t]};r&&r.forEach(a=>{e.setQueryData(a,t)}),o&&o.forEach(a=>{e.setQueriesData({queryKey:a},y)}),s&&s.forEach(a=>{e.setQueriesData({queryKey:a},n=>n&&{...n,pages:n.pages.map(y)})})};var _=({queryClient:e,ids:t,queryKeysOne:r,queryKeysList:o,queryKeysInfiniteList:s})=>{let u=y=>!y||!(y.data instanceof Array)?y:{...y,data:y.data.filter(a=>!t.some(n=>String(n)===String(a.id)))};r&&r.forEach(y=>{e.removeQueries({queryKey:y})}),o&&o.forEach(y=>{e.setQueriesData({queryKey:y},u)}),s&&s.forEach(y=>{e.setQueriesData({queryKey:y},a=>a&&{...a,pages:a.pages.map(u)})})};var P={getOne:(e,t)=>["get-one",e.path,e.params,String(t)],getOneArray:(e,t)=>t.map(r=>["get-one",e.path,e.params,String(r)]),getList:e=>["get-list",e.path,e.params],getInfiniteList:e=>["get-infinite-list",e.path,e.params],getDataQuery:e=>["query-data",e.path,e.params]};function w(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){let r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(let s of r){let u=e[s],y=t[s];if(u!==y&&!w(u,y))return!1}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]&&!w(e[r],t[r]))return!1;return!0}return e===t}var xt=({queryClient:e,queryKeys:t})=>{e.invalidateQueries({predicate:r=>{let o=r.queryKey;return t.some(s=>s.every(u=>o.some(y=>w(y,u))))}})};var L=({queryClient:e,queryKeys:t})=>{t.forEach(r=>{e.invalidateQueries({queryKey:r})})};function $(e,t){let r={...e};if(e instanceof Object&&t instanceof Object){for(let o in t)if(o in e){let s=e[o],u=t[o];typeof s==typeof u&&(Array.isArray(s)&&Array.isArray(u)||s!==null&&!Array.isArray(s)&&typeof s=="object"&&!Array.isArray(u)&&typeof u=="object"||typeof s!="object"&&typeof u!="object")&&(typeof s=="object"&&s!==null&&!Array.isArray(s)?r[o]=$(s,u):r[o]=u)}}return r}var J=({queryClient:e,data:t,ids:r,queryKeysOne:o,queryKeysList:s,queryKeysInfiniteList:u})=>{let y=a=>!a||!(a.data instanceof Array)?a:{...a,data:a.data.map(n=>r.some(c=>String(c)===String(n.id))?$(n,t):n)};o&&o.forEach(a=>{e.setQueriesData({queryKey:a},n=>!n||!(n.data instanceof Object)||!(t instanceof Object)?n:{...n,data:$(n.data,t)})}),s&&s.forEach(a=>{e.setQueriesData({queryKey:a},y)}),u&&u.forEach(a=>{e.setQueriesData({queryKey:a},n=>n&&{...n,pages:n.pages.map(y)})})};var B=async(e,t)=>{let r=t.reduce((o,s)=>o.concat(e.getQueriesData({queryKey:s})),[]);return await Promise.all(r.map(([o])=>e.cancelQueries({queryKey:o}))),r};var Y=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:o=[],shouldUpdateCurrentResource:s=!0,type:u="many"})=>{let{apiUrl:y,apiClient:a,apiEnsureTrailingSlash:n,toastUndo:c}=R(),i=Pe(),m=Qe([]),l=()=>{m.current.forEach(([p,d])=>{i.setQueryData(p,d)})},{mutate:D,...C}=he({...t,mutationKey:[u==="many"?"delete-many":"delete-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async p=>{let d=`${y}/${g(p.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:a,variables:p,url:d});let h=u==="many"?p.ids:[p.id],f=await Promise.allSettled(h.map(T=>a({url:`${d}${T}${n?"/":""}`,method:"DELETE",...p.apiClientParams}))),Q=[];return f.forEach(T=>{if(T.status==="fulfilled")Q.push(T.value);else throw T.reason}),u==="many"?Q:Q[0]},onSuccess:(...p)=>{let d=p[1],h=[P.getList(d.resource),P.getInfiniteList(d.resource)];o.forEach(f=>{h.push(P.getList(f)),h.push(P.getInfiniteList(f))}),L({queryClient:i,queryKeys:h}),t?.onSuccess&&t.onSuccess(...p)},onError:(...p)=>{t?.onError&&t.onError(...p),l()}});return{mutation:C,delete:async({resourceParams:p,undoMessage:d,...h})=>{let f={path:e,params:p},Q=u==="many"?h.ids:[h.id];if(r.optimistic){let T=s?P.getOneArray(f,Q):[],K=s?[P.getList(f)]:[],b=s?[P.getInfiniteList(f)]:[];o.forEach(E=>{T.push(...P.getOneArray(E,Q)),K.push(P.getList(E)),b.push(P.getInfiniteList(E))}),m.current=await B(i,[...T,...K,...b]),_({queryClient:i,ids:Q,queryKeysOne:T,queryKeysList:K,queryKeysInfiniteList:b})}if(r.undoable){let T=Q.length>1;F.once("end",K=>{K?l():D({...h,resource:f})}),c({message:d||`Element${T?"s":""} deleted`,type:T?"delete-many":"delete-one"})}else D({...h,resource:f})}}},Nt=e=>Y({...e,type:"one"}),Gt=e=>Y({...e,type:"many"});import{useMutation as De,useQueryClient as ge}from"@tanstack/react-query";import{useRef as Re}from"react";var X=({resourcePath:e,mutationOptions:t,mode:r={optimistic:!0,undoable:!0},extraResources:o=[],shouldUpdateCurrentResource:s=!0,type:u="many"})=>{let{apiUrl:y,apiClient:a,apiEnsureTrailingSlash:n,toastUndo:c}=R(),i=ge(),m=Re([]),l=()=>{m.current.forEach(([p,d])=>{i.setQueryData(p,d)})},{mutate:D,...C}=De({...t,mutationKey:[u==="many"?"update-many":"update-one",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async p=>{let d=`${y}/${g(p.resource,!0)}`;if(t?.mutationFn)return await t?.mutationFn({apiClient:a,variables:p,url:d});let h=u==="many"?p.ids:[p.id],f=await Promise.allSettled(h.map(T=>a({url:`${d}${T}${n?"/":""}`,method:"PATCH",data:p.data,...p.apiClientParams}))),Q=[];return f.forEach(T=>{if(T.status==="fulfilled")Q.push(T.value);else throw T.reason}),u==="many"?Q:Q[0]},onSuccess:(...p)=>{let d=p[1];if(!r.optimistic){let h=u==="many"?d.ids:[d.id],f=[...P.getOneArray(d.resource,h),P.getList(d.resource),P.getInfiniteList(d.resource)];o.forEach(Q=>{f.push(...P.getOneArray(Q,h)),f.push(P.getList(Q)),f.push(P.getInfiniteList(Q))}),L({queryClient:i,queryKeys:f})}t?.onSuccess&&t.onSuccess(...p)},onError:(...p)=>{t?.onError&&t.onError(...p),l()}});return{mutation:C,update:async({resourceParams:p,undoMessage:d,...h})=>{let f={path:e,params:p},Q=u==="many"?h.ids:[h.id];if(r.optimistic){let T=s?P.getOneArray(f,Q):[],K=s?[P.getList(f)]:[],b=s?[P.getInfiniteList(f)]:[];o.forEach(E=>{T.push(...P.getOneArray(E,Q)),K.push(P.getList(E)),b.push(P.getInfiniteList(E))}),m.current=await B(i,[...T,...K,...b]),J({queryClient:i,data:h.data,ids:Q,queryKeysOne:T,queryKeysList:K,queryKeysInfiniteList:b})}if(r.undoable){let T=Q.length>1;F.once("end",K=>{K?l():D({...h,resource:f})}),c({message:d||`Element${T?"s":""} updated`,type:T?"update-many":"update-one"})}else D({...h,resource:f})}}},rr=e=>X({...e,type:"one"}),ar=e=>X({...e,type:"many"});import{useMutation as Ce,useQueryClient as Ke}from"@tanstack/react-query";var yr=({resourcePath:e,mutationOptions:t,extraResources:r=[],shouldUpdateCurrentResource:o=!0,cacheAddItemTo:s="start"})=>{let{apiUrl:u,apiClient:y,apiEnsureTrailingSlash:a}=R(),n=Ke(),{mutate:c,...i}=Ce({...t,mutationKey:["create",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async l=>{let D=`${u}/${g(l.resource,a)}`;return t?.mutationFn?await t?.mutationFn({apiClient:y,variables:l,url:D}):await y({url:D,method:"POST",data:l.data,...l.apiClientParams})},onSuccess:(...l)=>{let D=l[0];if(D){let C=l[1],{id:x}=D.data,p=o?[P.getOne(C.resource,x)]:[],d=o?[P.getList(C.resource)]:[],h=o?[P.getInfiniteList(C.resource)]:[];r.forEach(f=>{p.push(P.getOne(f,x)),d.push(P.getList(f)),h.push(P.getInfiniteList(f))}),H({queryClient:n,data:D,queryKeysOne:p.map(f=>[...f,{}]),queryKeysList:d,queryKeysInfiniteList:h,cacheAddItemTo:s}),L({queryClient:n,queryKeys:[...d,...h]})}t?.onSuccess&&t.onSuccess(...l)}});return{mutation:i,create:({resourceParams:l,...D})=>{c({...D,resource:{path:e,params:l}})}}};import{useQuery as xe}from"@tanstack/react-query";var fr=({queryOptions:e,resource:t,params:r={},apiClientParams:o})=>{let{apiUrl:s,apiClient:u,apiEnsureTrailingSlash:y}=R();return xe({...e,queryKey:["query-data",t.path,t.params,r,...e?.queryKey?e.queryKey:[]],queryFn:async({queryKey:n})=>{let c={resource:t,params:r,queryKey:n},i=`${s}/${g(c.resource,y)}`;return e?.queryFn?await e?.queryFn({apiClient:u,variables:c,url:i}):await u({url:i,method:"GET",params:r,...o})}})};import{useMutation as be}from"@tanstack/react-query";var Qr=({resourcePath:e,mutationOptions:t})=>{let{apiUrl:r,apiClient:o,apiEnsureTrailingSlash:s}=R(),{mutate:u,...y}=be({...t,mutationKey:["mutate-data",e,...t?.mutationKey?t.mutationKey:[]],mutationFn:async n=>{let c=`${r}/${g(n.resource,s)}`;return t?.mutationFn?await t?.mutationFn({apiClient:o,variables:n,url:c}):await o({url:c,data:n.data,...n.apiClientParams})}});return{mutation:y,mutate:async({resourceParams:n,...c})=>{u({...c,resource:{path:e,params:n}})}}};export{S as CustomError,rt as RQWrapper,je as ToastBar,H as addItemFromQueryCache,_ as deleteItemsFromQueryCache,V as fetcher,g as getUrlFromResource,P as helpersQueryKeys,xt as invalidateMatchingQueries,L as invalidateQueries,ve as resolveToastValue,I as toast,J as updateItemsFromQueryCache,yr as useCreate,Qr as useDataMutate,fr as useDataQuery,Gt as useDeleteMany,Nt as useDeleteOne,lt as useGetInfiniteList,it as useGetList,Pt as useGetOne,R as useRQWrapperContext,ar as useUpdateMany,rr as useUpdateOne};
//# sourceMappingURL=index.mjs.map